<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="keywords" content="">
		<!-- Favicon -->
		<link rel="icon" href="" type="image/x-icon"/>
		<!-- Title -->
		<title>서울월드컵경기장</title>
		<!-- Bootstrap css-->
		<link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
		<!-- Icons css-->
		<link href="../assets/plugins/web-fonts/icons.css" rel="stylesheet"/>
		<link href="../assets/plugins/web-fonts/font-awesome/font-awesome.min.css" rel="stylesheet">
		<link href="../assets/plugins/web-fonts/plugin.css" rel="stylesheet"/>
		<!-- Style css-->
		<link href="../assets/css/style.css" rel="stylesheet">
		<link href="../assets/css/skins.css" rel="stylesheet">
		<!-- Sidemenu css-->
		<link href="../assets/css/sidemenu/sidemenu.css" rel="stylesheet">
		<link href="../assets/css/sangam.css" rel="stylesheet">
		<link href="../assets/css/twentytwenty.css" rel="stylesheet" type="text/css">
		<!-- Select2 css -->
		<link href="../assets/plugins/select2/css/select2.min.css" rel="stylesheet">
		<!--Bootstrap-datepicker css-->
		<link rel="stylesheet" href="../assets/plugins/bootstrap-datepicker/bootstrap-datepicker.css">
		<link href="../assets/plugins/spectrum-colorpicker/spectrum.css" rel="stylesheet">
		<!-- Internal Datetimepicker-slider css -->
		<link href="../assets/plugins/amazeui-datetimepicker/css/amazeui.datetimepicker.css" rel="stylesheet">
		<!-- Internal DataTables css-->
		<link href="../assets/plugins/datatable/dataTables.bootstrap4.min.css" rel="stylesheet" />
		<link href="../assets/plugins/datatable/responsivebootstrap4.min.css" rel="stylesheet" />
		<link href="../assets/plugins/datatable/fileexport/buttons.bootstrap4.min.css" rel="stylesheet" />
		<style type="text/css">
		.dataTables_filter label{
			color: #8c9fb9;
		}
		</style>
	</head>

	<body class="main-body leftmenu">
		<!-- Loader -->
		<div id="global-loader">
			<img src="../assets/img/loader.svg" class="loader-img" alt="Loader">
		</div>
		<!-- End Loader -->
		<!-- Page -->
		<div class="page">
			<!-- Sidemenu -->
			<?include "../include/sidebar.php";?>
			<!-- End Sidemenu -->

			<!-- Main Header-->
			<?include "../include/header.php";?>
			<!-- End Main Header-->
			<!-- Mobile-header -->

			<!-- //Mobile-header -->
			<!-- Main Content-->
			<div class="main-content side-content pt-0">
				<div class="container-fluid main-m-pt">
					<div class="inner-body">
						<!-- Page Header -->
						<div class="page-header">
							<div>
								<h2 class="main-content-title text-white tx-24 mg-b-5 font-weight-bold">사용자관리</h2>
								<ol class="breadcrumb">
									<li class="breadcrumb-item">Home</li>
									<li class="breadcrumb-item active" aria-current="page">사용자관리</li>
								</ol>
							</div>
						</div>
						<!-- End Page Header -->
						<!--Row-->
						<div class="row row-sm mt-4">
							<!-- col -->
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<div>
											<div class="d-flex-sb border-bottom">
												<label class="main-content-label my-auto pt-2 pb-2 tx-16">상세검색</label>
											</div>
										</div>
									</div>
									<div class="card-body">
										<div class="row row-sm">
											<div class="col-sm-12 col-lg-3 col-xl-2 mb-2">
												<select class="form-control" id="userCode">
													<option value="">전체</option>
													<option value="0">사용자</option>
													<option value="1">관리자</option>
												</select>
											</div>
											<div class="col-6 col-sm-6 col-lg-4 col-xl-2 margin-responsive">
												<div>
													<div class="input-group">
														<div class="input-group-prepend">
															<div class="input-group-text">
																<i class="fe fe-calendar lh--9 op-6"></i>
															</div>
														</div>
														<input class="form-control fc-datepicker" id="startDate" placeholder="시작일" type="text">
													</div>
												</div>
											</div>
											<div class="col-6 col-sm-6 col-lg-4 col-xl-2 margin-responsive">
												<div>
													<div class="input-group">
														<div class="input-group-prepend">
															<div class="input-group-text">
																<i class="fe fe-calendar lh--9 op-6"></i>
															</div>
														</div>
														<input class="form-control fc-datepicker" id="endDate" placeholder="종료일" type="text">
													</div>
												</div>
											</div>
											<div class="col-12 col-sm-12 col-lg-12 col-xl-6">
												<button class="btn ripple btn-bg pd-x-20" type="button" id="search">
													<i class="fe fe-search mr-2" style="vertical-align: inherit;"></i>조회하기
												</button>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<?
											if($_SESSION["userCode"]=='1'){
										?>
										<div>
											<div class="d-flex-sb2 border-bottom">
												<label class="main-content-label my-auto pt-2 pb-4 tx-16">관측정보</label>
												<div class="add-modal-btn">
													<button class="trigger"><i class="ion-podium mr-2"style="vertical-align: middle;"></i>회원추가</button>
												</div>
											</div>
										</div>
										<?
											}
										?>
									</div>
									<div class="card-body">
										<div class="table-responsive">
											<table class="table text-nowrap text-md-nowrap table-bordered table-hovered mg-b-0 text-center" id="userTable" style="width: 100%;">
												<thead>
													<tr class="text-center">
														<th>구분</th>
														<th>아이디</th>
														<th>담당자</th>
														<th>연락처</th>
														<th>부서</th>
														<th>권한</th>
														<th>등록일</th>
													</tr>
												</thead>
												<tbody>

												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
							<!-- col end -->
						</div>
						<!-- Row end -->
					</div>
				</div>
			</div>
			<!-- End Main Content-->
			<!-- modal content -->
			<div class="modal">
				<div class="modal-content wd-50p">
					<div class="modal-header">
						<h3>회원 추가</h3>
						<span class="close-button">×</span>
					</div>
					<form action="../php/insertUser.php" method="post" id="insertForm" onsubmit="return insertUser()">
					<div class="modal-body">
						<div class="row row-sm modal-scroll">
							<div class="form-group col-md-12 mb-4">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">아이디</label>
									</div>
									<div class="col-md-10">
										<input type="text" class="form-control" name="userId" id="userId" required="required">
										<button type="button" class="btn ripple btn-primary pd-x-15 mt-2" id="idCheck">중복확인</button>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12 mb-4">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">비밀번호</label>
									</div>
									<div class="col-md-10">
										<input type="password" name="password" class="form-control"  required="required">
									</div>
								</div>
							</div>
							<div class="form-group col-md-12 mb-4">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">비밀번호 확인</label>
									</div>
									<div class="col-md-10">
										<input type="password" name="password2" class="form-control" placeholder="비밀번호를 다시 입력해주세요." required="required">
									</div>
								</div>
							</div>
							<div class="form-group col-md-12 mb-4">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">담당자</label>
									</div>
									<div class="col-md-10">
										<input type="text" name="userName" class="form-control"  required="required">
									</div>
								</div>
							</div>
							<div class="form-group col-md-12 mb-4">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">권한 설정</label>
									</div>
									<div class="col-md-10">
										<ul class="nav nav-tabs nav-tabs-solid nav-justified border-0">
											<li class="nav-item mr-2"><a href="#" class="tab-link wd-100p active" data-toggle="tab">사용자</a></li>
											<li class="nav-item"><a href="#" class="tab-link wd-100p" data-toggle="tab">관리자</a></li>
										</ul>
										<input type="hidden" name="userCode" id="" value="0"/>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12 mb-4">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">부서</label>
									</div>
									<div class="col-md-10">
										<select class="form-control" name="dept" required="required">
											<option>부서선택</option>
											<option value="관리">관리</option>
											<option value="행정">행정</option>
											<option value="기상">기상</option>
										</select>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2">
										<label class="form-label pt-2">연락처</label>
									</div>
									<div class="col-md-10">
										<div class="row row-sm">
											<div class="col-md-4 col-4">
												<input type="text" class="form-control" name="hp1"  pattern="[0-9]+" required="required">
											</div>
											<div class="col-md-4 col-4">
												<input type="text" class="form-control" name="hp2"  pattern="[0-9]+" required="required">
											</div>
											<div class="col-md-4 col-4">
												<input type="text" class="form-control" name="hp3"  pattern="[0-9]+" required="required">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="add-modal-btn mt-3 modal-btn-border">
							<button type="submit">등록</button>
							<button type="button" class="cancel-button">취소</button>
						</div>
					</div>
					</form>
				</div>
			</div>
			<div class="modal2">
				<div class="modal-content wd-40p">
					<div class="modal-header">
						<h3>회원정보</h3>
						<span class="close-button2">×</span>
					</div>
					<div class="modal-body">
						<div class="row row-sm">
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2 col-3">
										<label class="form-label mb-0">아이디</label>
									</div>
									<div class="col-md-1 col-1">
										<label class="form-label mb-0">:</label>
									</div>
									<div class="col-md-9 col-8">
										<label class="form-label mb-0">asdf1234</label>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2 col-3">
										<label class="form-label mb-0">비밀번호</label>
									</div>
									<div class="col-md-1 col-1">
										<label class="form-label mb-0">:</label>
									</div>
									<div class="col-md-9 col-8">
										<label class="form-label mb-0">************</label>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2 col-3">
										<label class="form-label mb-0">담당자</label>
									</div>
									<div class="col-md-1 col-1">
										<label class="form-label mb-0">:</label>
									</div>
									<div class="col-md-9 col-8">
										<label class="form-label mb-0">홍길동<span class="user-rating user-color">사용자</span></label>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2 col-3">
										<label class="form-label mb-0">부서</label>
									</div>
									<div class="col-md-1 col-1">
										<label class="form-label mb-0">:</label>
									</div>
									<div class="col-md-9 col-8">
										<label class="form-label mb-0">관리담당</label>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2 col-3">
										<label class="form-label mb-0">연락처</label>
									</div>
									<div class="col-md-1 col-1">
										<label class="form-label mb-0">:</label>
									</div>
									<div class="col-md-9 col-8">
										<label class="form-label mb-0">010-1234-5678</label>
									</div>
								</div>
							</div>
							<div class="form-group col-md-12">
								<div class="row row-sm">
									<div class="col-md-2 col-3">
										<label class="form-label mb-0">등록일</label>
									</div>
									<div class="col-md-1 col-1">
										<label class="form-label mb-0">:</label>
									</div>
									<div class="col-md-9 col-8">
										<label class="form-label mb-0">2023-01-11 10:23</label>
									</div>
								</div>
							</div>
						</div>
						<div class="add-modal-btn mt-3 modal-btn-border">
							<button type="button" onclick="location.href='user-management-modify.html';">수정</button>
							<button type="button" style="background: #048faf; color: #fff;">삭제</button>
							<button type="button">확인</button>
						</div>
					</div>
				</div>
			</div>
			<!-- /modal content -->
			<!-- Main Footer-->
			<div class="main-footer text-center">
				<div class="container">
					<div class="row row-sm">
						<div class="col-md-12">
							<span class="text-white">Copyright © 2023 <a style="color: #80b9ed;">서울월드컵경기장</a></span>
						</div>
					</div>
				</div>
			</div>
			<!--End Footer-->
		</div>
		<!-- End Page -->

		<!-- Back-to-top -->
		<a href="#top" id="back-to-top"><i class="fe fe-arrow-up"></i></a>

		<!-- Jquery js-->
		<script src="../assets/plugins/jquery/jquery.min.js"></script>

		<!-- Bootstrap js-->
		<script src="../assets/plugins/bootstrap/js/popper.min.js"></script>
		<script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>

		<!-- Peity js-->
		<script src="../assets/plugins/peity/jquery.peity.min.js"></script>
		<!-- Internal Jquery-Ui js-->
		<script src="../assets/plugins/jquery-ui/ui/widgets/datepicker.js"></script>
		<!-- Select2 js-->
		<script src="../assets/plugins/select2/js/select2.min.js"></script>
		<!-- Internal Chart.Bundle js-->
		<script src="../assets/plugins/chart.js/Chart.bundle.min.js"></script>
		<!-- Internal Jquery.maskedinput js-->
		<script src="../assets/plugins/jquery.maskedinput/jquery.maskedinput.js"></script>
		<!-- Sidemenu js -->
		<script src="../assets/plugins/sidemenu/sidemenu.js"></script>

		<!-- Internal Specturm-colorpicker js-->
		<script src="../assets/plugins/spectrum-colorpicker/spectrum.js"></script>
		<!-- Select2 js-->
		<script src="../assets/plugins/select2/js/select2.min.js"></script>
		<script src="../assets/js/select2.js"></script>
		<!--Bootstrap-datepicker js-->
		<script src="../assets/plugins/bootstrap-datepicker/bootstrap-datepicker.js"></script>
		<!-- Internal jquery-simple-datetimepicker js -->
		<script src="../assets/plugins/amazeui-datetimepicker/js/amazeui.datetimepicker.min.js"></script>

		<!-- Internal Data Table js -->
		<script src="../assets/plugins/datatable/jquery.dataTables.min.js"></script>
		<script src="../assets/plugins/datatable/dataTables.bootstrap4.min.js"></script>
		<script src="../assets/plugins/datatable/dataTables.responsive.min.js"></script>
		<script src="../assets/plugins/datatable/fileexport/dataTables.buttons.min.js"></script>
		<script src="../assets/plugins/datatable/fileexport/buttons.bootstrap4.min.js"></script>
		<script src="../assets/js/table-data.js"></script>
		<!-- Internal Dashboard js-->
		<script src="../assets/js/crypto-exchange.js"></script>
		<!-- Internal Form-elements js-->
		<script src="../assets/js/form-elements.js"></script>
		<!-- Sticky js -->
		<script src="../assets/js/sticky.js"></script>
		<!-- twentytwenty -->
		<script src="../assets/js/jquery.event.move.js"></script>
		<script src="../assets/js/jquery.twentytwenty.js"></script>
		<!-- Custom js -->
		<script src="../assets/js/custom.js"></script>
		<script>
			$(document).ready(function() {  
				//$(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct: 0.5});
				//$(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct: 0.5, orientation: 'vertical'});
				$("#sensorBtn-1").click(function(){
					$("#sensorDate-1").toggle();
					$("#infoBox").toggle();
				});
				
				$("#addContact").on("click", function() {  
					$("#more-contact").append("<div class='form-group'><input type='text' class='form-control' id='' placeholder=''/></div>");  
				});  
				$("#removeContact").on("click", function() {  
					$("#more-contact").children().last().remove();  
				});

				let modal = document.querySelector(".modal");
				let trigger = document.querySelector(".trigger");
				let closeButton = document.querySelector(".close-button");
				let cancelButton = document.querySelector(".cancel-button");
				
				function toggleModal() {
					modal.classList.toggle("show-modal");
				}
		
				function windowOnClick(event) {
					if (event.target === modal) {
						toggleModal();
					}
				}

				if(trigger) {
					trigger.addEventListener("click", toggleModal);
				}
				closeButton.addEventListener("click", toggleModal);
				window.addEventListener("click", windowOnClick);
				cancelButton.addEventListener("click", toggleModal);
			
				let modal2 = document.querySelector(".modal2");
				let trigger2 = document.querySelector(".trigger2");
				let closeButton2 = document.querySelector(".close-button2");
		
				function toggleModal2() {
					modal2.classList.toggle("show-modal2");
				}
		
				function windowOnClick2(event) {
					if (event.target === modal2) {
						toggleModal2();
					}
				}
		
				//trigger2.addEventListener("click", toggleModal2);
				closeButton2.addEventListener("click", toggleModal2);
				window.addEventListener("click", windowOnClick2);
				
				$('#search').on('click',function(){
					getUserList()
				})
				
				var dataTable = null;
				
				function getUserList(){
					
					var param = {
						startDate : $('#startDate').val(),
						endDate : $('#endDate').val(),
						userCode : $('#userCode').val()
					}
					
					if(dataTable!=null){
						dataTable.destroy();
					}
					
					$.ajax({
						url : "../php/userList.php",
						method : "GET",
						data : param,
						success : function(result){
							console.log(result);
							var dataHead = [{"data" : "SEQ"},{"data" : "USER_ID"},{"data" : "USER_NAME"},{"data" : "HP"},{"data" : "DEPT"},{"data":"USER_CODE"},{"data" : "REG_DATE"}];
							
							dataTable = $('#userTable').DataTable({
					            "language": {
					                //url: "../global_assets/js/plugins/tables/datatables/localization_kor.min.json",
				        			searchPlaceholder: '검색...',
				        			sSearch: '',
				        			lengthMenu: '_MENU_ 출력수',
					            },
								//"dom": 'Blfrtip',
								"data": result,
						        "columns": dataHead,
						        "deferRender": true,
						        //"aaSorting": ["USER_ID"],
						        "scrollX": true,
						        createdRow: function (row, data, index) {
						        	//$(row).attr("data-toggle" ,"modal").attr("data-target" ,"#new-Test").css("cursor","pointer");
									
						        	row.onclick = function (e){
						        		
						        		var form = document.createElement('form');

						        		var objs;
						        		objs = document.createElement('input');
						        		objs.setAttribute('type', 'hidden');
						        		objs.setAttribute('name', 'userId');
						        		objs.setAttribute('value', data.USER_ID);
						        		form.appendChild(objs);
						        		form.setAttribute('method', 'post');
						        		form.setAttribute('action', "./user-management-modify.html");
						        		
						        		document.body.appendChild(form);
						        		form.submit();
						        	}
						        }
							})
						}
					})
				}
				
				getUserList();
				
				$('.wd-100p:eq(0)').on('click',function(){
					$('#userCode').val(0)
				})
				
				$('.wd-100p:eq(1)').on('click',function(){
					$('#userCode').val(1)
				})
				
				$('#idCheck').on('click',function(){
					var chk = idCheck();
					if(chk){
					    alert("사용가능한 아이디입니다.")
					}else{
					    alert("이미 사용중인 아이디입니다.")
					}
				})
				
			});  
			
			function checkNumber(event) {
			  if(event.key === '.' 
			     || event.key === '-'
			     || event.key >= 0 && event.key <= 9) {
			    return true;
			  }
			  
			  return false;
			}
			
			function idCheck(){
			    
			    let resultData;
			    
			    $.ajax({
					url : "../php/idCheck.php",
					data : "userId="+$('#userId').val(),
					method : "POST",
					async : false,
					success : function(result){
					    if(result*1>0){
							resultData = false;
					    }else{
							resultData = true;
					    }
					}
		    	})
		    	
		    	return resultData;
			}
			
			function insertUser(){

				<?
				if($_SESSION["userCode"]!='1') {
					echo 'alert("권한이 부족합니다.");location.reload();return;';
				}
				?>

				if(confirm("사용자를 등록하시겠습니까?")){
					
				    if(idCheck()==false){
						alert("동일 아이디가 이미 사용중입니다.")
						return false;
				    }
				    
					if($('#insertForm [name="password"]').val() != '' && $('#insertForm [name="password"]').val()!=$('#insertForm [name="password2"]').val()){
						alert('비밀번호 확인이 일치하지 않습니다.');
						return false;
					}
					
					if($('#insertForm [name="password"]').val() != '' && $('#insertForm [name="password"]').val().length<4){
						alert('비밀번호는 4자리 이상 입력해주세요.');
						return false;
					}
					
					return true;
				}
				
				return false;
			}
		</script>
	</body>
</html>
