<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <!-- Favicon -->
    <link rel="icon" href="" type="image/x-icon"/>
    <!-- Title -->
    <title>상암월드컵경기장</title>
    <!-- Bootstrap css-->
    <link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Icons css-->
    <link href="../assets/plugins/web-fonts/icons.css" rel="stylesheet"/>
    <link href="../assets/plugins/web-fonts/font-awesome/font-awesome.min.css" rel="stylesheet">
    <link href="../assets/plugins/web-fonts/plugin.css" rel="stylesheet"/>
    <!-- Style css-->
    <link href="../assets/css/style.css" rel="stylesheet">
    <link href="../assets/css/skins.css" rel="stylesheet">
    <!-- Sidemenu css-->
    <link href="../assets/css/sidemenu/sidemenu.css" rel="stylesheet">
    <link href="../assets/css/sangam.css" rel="stylesheet">
    <link href="../assets/css/twentytwenty.css" rel="stylesheet" type="text/css">
    <!-- Select2 css -->
    <link href="../assets/plugins/select2/css/select2.min.css" rel="stylesheet">
    <!--Bootstrap-datepicker css-->
    <link rel="stylesheet" href="../assets/plugins/bootstrap-datepicker/bootstrap-datepicker.css">
    <link href="../assets/plugins/spectrum-colorpicker/spectrum.css" rel="stylesheet">
    <!-- Internal Datetimepicker-slider css -->
    <link href="../assets/plugins/amazeui-datetimepicker/css/amazeui.datetimepicker.css" rel="stylesheet">
    <!-- Internal DataTables css-->
    <link href="../assets/plugins/datatable/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="../assets/plugins/datatable/responsivebootstrap4.min.css" rel="stylesheet" />
    <link href="../assets/plugins/datatable/fileexport/buttons.bootstrap4.min.css" rel="stylesheet" />
    <style>
        .calendar .event {
            line-height: 12px;
        }

        @media (max-width: 700px){
            .calendar-btn > button:nth-child(1) {
                padding: 4px 8px;
            }
            .calendar-btn > button:nth-child(2) {
                padding: 4px 8px;
            }
            .calendar-btn > button:nth-child(3) {
                padding: 4px 5px;
            }
            .main-content .container, .main-content .container-fluid {
                padding-left: 10px;
                padding-right: 10px;
            }
            .calendar .days li {
                padding: 2px;
            }
            .calendar .event {
                /*min-height: 25px;*/
                padding: 4px;
                line-height: 12px;
                height: auto;
            }
            .calendar .event-desc {
                margin: 0px;
            }
        }

        @media (max-width: 440px) {
            .row-sm > div {
                padding-right: 5px;
                padding-left: 5px;
            }
            .card-body{
                padding-right: 5px;
                padding-left: 5px;
            }
        }

        .today-td{
            border: 3px solid dodgerblue !important;
        }
        .event-fan{
            background-color: #6699FF !important;
        }
        .event-main{
            background-color: #47C83E !important;
        }
        .fe-edit,.fe-trash{
            cursor: pointer;
        }
        #chkZone{
            color: white;
            margin-top: -10px;
            margin-bottom: 5px;
            display: flex;
            flex-direction: row;
        }
        #chkZone .ckbox{
            margin-right: 5px;
        }
        .calendar .days li {
            max-height: 151px;
            overflow-y: auto;
        }

        .ckbox{
            padding-right: 10px;
        }

        .tests{
            width: 80px;
            border-radius: 2px;
            display: flex;
            background-color: #16293a;
            background-clip: padding-box;
            border: 1px solid #16293a;
            color: white;
            padding-left: 7px;
            font-size: 15px;
        }

        .list-scroll {
            height: 350px;
        }
    </style>
</head>

<body class="main-body leftmenu">
<!-- Loader -->
<div id="global-loader">
    <img src="../assets/img/loader.svg" class="loader-img" alt="Loader">
</div>
<!-- End Loader -->
<!-- Page -->
<div class="page">
    <!-- Sidemenu -->
    <?include "../include/sidebar.php";?>
    <!-- End Sidemenu -->

    <!-- Main Header-->
    <?include "../include/header.php";?>
    <!-- End Main Header-->
    <!-- Mobile-header -->

    <!-- //Mobile-header -->
    <!-- Main Content-->
    <div class="main-content side-content pt-0">
        <div class="container-fluid main-m-pt">
            <div class="inner-body">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h2 class="main-content-title text-white tx-24 mg-b-5 font-weight-bold">작업정보 캘린더</h2>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">Home</li>
                            <li class="breadcrumb-item active" aria-current="page">작업정보 캘린더</li>
                        </ol>
                    </div>
                </div>
                <!-- End Page Header -->
                <!--Row-->
                <div class="row row-sm mt-4">
                    <!-- col -->
                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                        <div class="card custom-card overflow-hidden">
                            <div class="card-body">
                                <div class="calendar-wrap">
                                    <div class="calendar-header">
                                        <div class="calendar-btn">
                                            <button class="calendar-left" onclick="prevMonth()"><i class="fa fa-angle-left" style="vertical-align: middle;"></i></button>
                                            <button class="calendar-right" onclick="nextMonth()"><i class="fa fa-angle-right" style="vertical-align: middle;"></i></button>
                                            <button class="calendar-today" onclick="goToday()">오늘</button>
                                        </div>
                                        <h1 class="d-title">2023년 02월</h1>
                                        <div class="add-modal-btn calendar-sub-btn">
                                            <button class="trigger" id="addBtn"><i class="fe fe-plus-square mr-2" style="vertical-align: middle;"></i>추가</button>
                                            <!--<button class="text-white" onclick="location.href='work-history.html';"><i class="fe fe-list sidemenu-icon mr-2" style="vertical-align: middle;"></i>작업내역 보기</button>-->
                                        </div>
                                    </div>
                                    <div id="chkZone">
                                        <label class="ckbox">
                                            <input type="checkbox" name="searchList[]" value="fan" ><span>쿨링팬</span>
                                        </label>
                                    </div>
                                    <div class="calendar">
                                        <ul class="weekdays">
                                            <li>일요일</li>
                                            <li>월요일</li>
                                            <li>화요일</li>
                                            <li>수요일</li>
                                            <li>목요일</li>
                                            <li>금요일</li>
                                            <li>토요일</li>
                                        </ul>
                                        <ul class="days dates">
                                            <li class="day other-month">
                                                <div class="date">29</div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">30</div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">31</div>
                                            </li>
                                            <li class="day">
                                                <div class="date">1</div>
                                            </li>
                                            <li class="day">
                                                <div class="date">2</div>
                                            </li>
                                            <li class="day">
                                                <div class="date">3</div>
                                            </li>
                                            <li class="week-box">
                                                <h4>1th Week</h4>
                                            </li>
                                            <li class="day saturday">
                                                <div class="date">4<span>Saturday</span></div>
                                            </li>
                                            <li class="week-box">
                                                <h4>2th Week</h4>
                                            </li>
                                            <li class="day sunday">
                                                <div class="date">5<span>SUNDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">6<span>MONDAY</span></div>
                                                <div class="event trigger2">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day">
                                                <div class="date">7<span>TUESDAY</span></div>
                                                <div class="event trigger2">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                                <div class="event">
                                                    <div class="event-desc">
                                                        기상센서 점검
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day">
                                                <div class="date">8<span>WEDNESDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">9<span>THURSDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                                <div class="event">
                                                    <div class="event-desc">
                                                        기상센서 점검
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day">
                                                <div class="date">10<span>FRIDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day saturday">
                                                <div class="date">11<span>SATURDAY</span></div>
                                            </li>
                                            <li class="week-box">
                                                <h4>3th Week</h4>
                                            </li>
                                            <li class="day sunday">
                                                <div class="date">12<span>SUNDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">13<span>MONDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                                <div class="event">
                                                    <div class="event-desc">
                                                        기상센서 점검
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day">
                                                <div class="date">14<span>TUESDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">15<span>WEDNESDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">16<span>THURSDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">17<span>FRIDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day saturday">
                                                <div class="date">18<span>SATURDAY</span></div>
                                            </li>
                                            <li class="week-box">
                                                <h4>4th Week</h4>
                                            </li>
                                            <li class="day sunday">
                                                <div class="date">19<span>SUNDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">20<span>MONDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">21<span>TUESDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">22<span>WEDNESDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day">
                                                <div class="date">23<span>THURSDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">24<span>FRIDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                                <div class="event">
                                                    <div class="event-desc">
                                                        기상센서 점검
                                                    </div>
                                                    <div class="event-time"></div>
                                                </div>
                                            </li>
                                            <li class="day saturday">
                                                <div class="date">25<span>SATURDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="week-box">
                                                <h4>5th Week</h4>
                                            </li>
                                            <li class="day sunday">
                                                <div class="date">26<span>SUNDAY</span></div>
                                            </li>
                                            <li class="day">
                                                <div class="date">27<span>MONDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day">
                                                <div class="date">28<span>TUESDAY</span></div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">1<span>WEDNESDAY</span></div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">2<span>THURSDAY</span></div>
                                                <div class="event">
                                                    <div class="event-desc m-t-20">
                                                        관측 작업
                                                    </div>
                                                </div>
                                                <div class="event">
                                                    <div class="event-desc">
                                                        기상센서 점검
                                                    </div>
                                                </div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">3<span>FRIDAY</span></div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">4<span>SATURDAY</span></div>
                                            </li>
                                            <li class="week-box">
                                                <h4>6th Week</h4>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">5<span>SUNDAY</span></div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">6<span>MONDAY</span></div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">7</div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">8</div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">9</div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">10</div>
                                            </li>
                                            <li class="day other-month">
                                                <div class="date">11</div>
                                            </li>
                                        </ul>
                                        <div style="position: absolute;top: 0px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- col end -->
                </div>
                <!-- Row end -->
            </div>
        </div>
    </div>
    <!-- End Main Content-->
    <!-- modal content -->
    <div class="modal" tabindex="-1">
        <div class="modal-content wd-40p">
            <div class="modal-header">
                <h3>작업 일정 설정</h3>
                <span class="close-button">×</span>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="row row-sm modal-scroll list-scroll">
                        <div class="col-md-12">
                            <div class="form-group mb-1">
                                <p class="mg-b-10 modal-input-label">주요일정명</p>
                                <input type="text" class="form-control" name="primaryWork" id="primaryWork">
                            </div>
                        </div>
                        <div class="col-md-12 col-12">
                            <div class="form-group mb-1">
                                <p class="mg-b-10 modal-input-label">작업일자</p>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text">
                                            <i class="fe fe-calendar lh--9 op-6"></i>
                                        </div>
                                    </div>
                                    <input class="form-control fc-datepicker" placeholder="시작일" type="text" name="workDate" id="workDate">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="form-group mb-1">
                                <p class="mg-b-10 modal-input-label">오전 작업</p>
                                <select class="form-control" name="amWorkMain" id="amMainType">
                                    <option value="미정">미정</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="form-group mb-1">
                                <p class="mg-b-10 modal-input-label">오전 작업(상세)</p>
                                <select class="form-control" name="amWorkSub" id="amSubType">

                                </select>
                            </div>
                        </div>

                        <div class="col-md-3 col-6">
                            <div class="form-group mb-1">
                                <p class="mg-b-10 modal-input-label">오후 작업</p>
                                <select class="form-control" name="pmWorkMain" id="pmMainType">
                                    <option value="미정">미정</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="form-group mb-1">
                                <p class="mg-b-10 modal-input-label">오후 작업(상세)</p>
                                <select class="form-control" name="pmWorkSub" id="pmSubType">

                                </select>
                            </div>
                        </div>

                        <!--
                        <div class="col-md-12">
                            <div class="form-group">
                                <p class="mg-b-10 modal-input-label">작업 리스트</p>
                                <div style="flex-direction: row;display: flex;color: white">
                                    <label class="ckbox">
                                        <input type="checkbox" name="remoteCode[]" value="FAN10" checked="checked">
                                        <span>관수</span>
                                    </label>
                                    <label class="ckbox">
                                        <input type="checkbox" name="remoteCode[]" value="FAN10" checked="checked">
                                        <span>부분관수</span>
                                    </label>
                                    <label class="ckbox">
                                        <input type="text" style="width: 20px;display: flex"/>
                                    </label>
                                </div>
                            </div>
                            <div id="more-contact"></div>
                        </div>
                        -->
                    </div>
                    <!--
                    <div class="input-add-btn">
                        <button id="addContact" type="button" class="mr-2"><i class="ti-plus"></i></button>
                        <button id="removeContact" type="button"><i class="ti-minus"></i></button>
                    </div>
                    -->
                    <div class="add-modal-btn mt-3 modal-btn-border">
                        <button type="button" id="insertWaterTask">등록</button>
                        <button type="button" class="cancel-button">취소</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- /modal content -->
    <div class="modal" id="modal2">
        <div class="modal-content">
            <div class="modal-header">
                <h3>작업 목록 상세</h3>
                <span class="close-button2">×</span>
            </div>
            <div class="modal-body">
                <div class="row row-sm">
                    <div class="table-responsive">
                        <table class="table table-bordered text-center scrolltable2">
                            <thead>
                            <tr class="text-center">
                                <th>구분</th>
                                <th>유형</th>
                                <th>작업명</th>
                                <th>작업목록</th>
                                <th>작성자</th>
                                <th>일시</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody id="detailTable">
                            <tr class="text-center">
                                <td>1</td>
                                <td>관수</td>
                                <td>관수작업</td>
                                <td>관수 작업 및 점검 내용입니다.</td>
                                <td>홍길동</td>
                                <td>2022-10-11 10:23</td>
                                <td><i class="fe fe-edit"></i><i class="fe fe-trash"></i></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="add-modal-btn mt-3 modal-btn-border">
                    <button type="button" style="background: #3b76e1;color: #fff;">확인</button>
                    <button type="button" class="cancel-button2">취소</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /modal content -->
    <!-- Main Footer-->
    <div class="main-footer text-center">
        <div class="container">
            <div class="row row-sm">
                <div class="col-md-12">
                    <span class="text-white">Copyright © 2023 <a style="color: #80b9ed;">상암월드컵경기장</a></span>
                </div>
            </div>
        </div>
    </div>
    <!--End Footer-->
</div>
<!-- End Page -->

<!-- Back-to-top -->
<a href="#top" id="back-to-top"><i class="fe fe-arrow-up"></i></a>

<!-- Jquery js-->
<script src="../assets/plugins/jquery/jquery.min.js"></script>

<!-- Bootstrap js-->
<script src="../assets/plugins/bootstrap/js/popper.min.js"></script>
<script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>

<!-- Peity js-->
<script src="../assets/plugins/peity/jquery.peity.min.js"></script>
<!-- Internal Jquery-Ui js-->
<script src="../assets/plugins/jquery-ui/ui/widgets/datepicker.js"></script>
<!-- Select2 js-->
<script src="../assets/plugins/select2/js/select2.min.js"></script>
<!-- Internal Chart.Bundle js-->
<script src="../assets/plugins/chart.js/Chart.bundle.min.js"></script>
<!-- Internal Jquery.maskedinput js-->
<script src="../assets/plugins/jquery.maskedinput/jquery.maskedinput.js"></script>
<!-- Sidemenu js -->
<script src="../assets/plugins/sidemenu/sidemenu.js"></script>

<!-- Internal Specturm-colorpicker js-->
<script src="../assets/plugins/spectrum-colorpicker/spectrum.js"></script>
<!-- Select2 js-->
<script src="../assets/plugins/select2/js/select2.min.js"></script>
<script src="../assets/js/select2.js"></script>
<!--Bootstrap-datepicker js-->
<script src="../assets/plugins/bootstrap-datepicker/bootstrap-datepicker.js"></script>
<!-- Internal jquery-simple-datetimepicker js -->
<script src="../assets/plugins/amazeui-datetimepicker/js/amazeui.datetimepicker.min.js"></script>

<!-- Internal Data Table js -->
<script src="../assets/plugins/datatable/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatable/dataTables.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatable/dataTables.responsive.min.js"></script>
<script src="../assets/plugins/datatable/fileexport/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatable/fileexport/buttons.bootstrap4.min.js"></script>
<script src="../assets/js/table-data.js"></script>
<!-- Internal Dashboard js-->
<script src="../assets/js/crypto-exchange.js"></script>
<!-- Internal Form-elements js-->
<script src="../assets/js/form-elements.js"></script>
<!-- Sticky js -->
<script src="../assets/js/sticky.js"></script>
<!-- twentytwenty -->
<script src="../assets/js/jquery.event.move.js"></script>
<script src="../assets/js/jquery.twentytwenty.js"></script>
<!-- Custom js -->
<script src="../assets/js/custom.js"></script>
<script>
    $(document).ready(function() {
        $(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct: 0.5});
        $(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct: 0.5, orientation: 'vertical'});
        $("#addContact").on("click", function() {
            $("#more-contact").append("<div class='form-group'><input type='text' class='form-control' id='' placeholder=''/></div>");
        });
        $("#removeContact").on("click", function() {
            $("#more-contact").children().last().remove();
        });

        modal = document.querySelector(".modal");
        let trigger = document.querySelector(".trigger");
        let closeButton = document.querySelector(".close-button");
        let cancelButton = document.querySelector(".cancel-button");

        toggleModal = function() {
            modal.classList.toggle("show-modal");
        }

        function windowOnClick(event) {
            if (event.target === modal) {
                toggleModal();
            }
        }

        trigger.addEventListener("click", toggleModal);
        closeButton.addEventListener("click", toggleModal);
        window.addEventListener("click", windowOnClick);
        cancelButton.addEventListener("click", toggleModal);

        let modal2 = document.querySelector("#modal2");
        let closeButton2 = document.querySelector(".close-button2");
        let cancelButton2 = document.querySelector(".cancel-button2");

        function toggleModal2() {
            modal2.classList.toggle("show-modal");
        }

        closeButton2.addEventListener("click", toggleModal2);
        cancelButton2.addEventListener("click", toggleModal2);

    });

    function getMainType(){
        $.ajax({
            url : "../php/getWorkMainType.php",
            async : false,
            success : function(result){
                console.log(result)
                $.each(result,function(index,item){
                    $('#chkZone').append(`<label class="ckbox">
                            <input type="checkbox" name="searchList[]" value="${item}" checked="checked"><span>${item}</span>
                        </label>`)

                    $('#amMainType,#pmMainType').append(`<option value="${item}">${item}</option>`)
                })
                /*
                $('#chkZone').append(`<label class="ckbox">
                    <input type="checkbox" name="searchList[]" value="기타" checked="checked"><span>기타</span>
                </label>`)*/
            }
        })
    }

    function getSubType(mainType){

        let subList = "";

        if(mainType==null){
            mainType = "관수"
        }

        $.ajax({
            url : "../php/getWorkSubType.php",
            data : "mainType="+mainType,
            async : false,
            success : function(result){
                subList = result;
            }
        })

        return subList;
    }

    $('#amMainType').on('change',function(){
        $('#amSubType').empty()

        if($(this).val()=="미정"){
            $('#amSubType').replaceWith(`<select class="form-control" name="amWorkSub" id="amSubType"></select>`)
            $('#amSubType').prop('disabled',true)
        }else if($(this).val()=="기타"){
            $('#amSubType').prop('disabled',false)
            $('#amSubType').replaceWith(`<input class="form-control" type="text" id="amSubType" name="amWorkSub"/>`)
        }else{
            $('#amSubType').replaceWith(`<select class="form-control" name="amWorkSub" id="amSubType"></select>`)
            $('#amSubType').prop('disabled',false)
            let subList = getSubType($(this).val());

            $.each(subList,function(index,item){
                $('#amSubType').append(`<option value="${item}">${item}</option>`)
            })
        }
    })

    $('#pmMainType').on('change',function(){

        $('#pmSubType').empty()

        if($(this).val()=="미정"){
            $('#pmSubType').replaceWith(`<select class="form-control" name="pmWorkSub" id="pmSubType"></select>`)
            $('#pmSubType').prop('disabled',true)
        }else if($(this).val()=="기타"){
            $('#pmSubType').prop('disabled',false)
            $('#pmSubType').replaceWith(`<input class="form-control" type="text" id="pmSubType" name="pmWorkSub"/>`)
        }else{
            $('#pmSubType').replaceWith(`<select class="form-control" name="pmWorkSub" id="pmSubType"></select>`)
            $('#pmSubType').prop('disabled',false)
            let subList = getSubType($(this).val());

            $.each(subList,function(index,item){
                $('#pmSubType').append(`<option value="${item}">${item}</option>`)
            })
        }

    })

    getMainType()
    $('#amMainType').trigger('change')
    $('#pmMainType').trigger('change')
    /*
    $('#workDate').datepicker({
        showOtherMonths: true,
        selectOtherMonths: true
    });*/

    $('#insertWaterTask').on('click',function(){
        if($('#workName').val()=='' && $('#pmMainType').val()=='미지정' && $('#amMainType').val()=='미지정'){
            alert("주요일정 또는 오전/오후 작업을 입력해주세요.")
            return;
        }

        if($('#workDate').val()==''){
            alert('날짜를 입력해주세요.')
            return;
        }

        let check = confirm("작업을 등록하시겠습니까?");
        if(check){
            //insertWaterTask();
            insertWorkReservation();
        }
    })

    function insertWorkReservation(){
        let param = $('#taskForm').serialize();

        $.ajax({
            url : "../php/insertWorkReservation.php",
            data : param,
            method : "POST",
            success : function(){
                toggleModal();
                renderCalendar();
            }
        })
    }



    $(document).on('click','.day',function(){
        if($(this).hasClass('other-month')){
            return;
        }else {
            let tm = monthSet+"-"+String($(this).data('tm')).padStart(2,'0');
            modal.classList.toggle("show-modal");

            dayData(tm)
        }
    })

    $(document).on('change','#chkZone input[type=checkbox]',function(){
        monthData()
    })

    $(document).on('click','#addBtn',function(){
        $('#taskForm input').val('')
        $('#taskForm #amMainType').val('미정').trigger('change')
        $('#taskForm #pmMainType').val('미정').trigger('change')
    })

    let date = new Date();
    let saveDate = '';
    let monthSet='';

    const renderCalendar = () => {
        const viewYear = date.getFullYear();
        const viewMonth = date.getMonth();


        let viewMonth2 = viewMonth;
        if((viewMonth+1)<10){
            viewMonth2 = '0'+(viewMonth+1);
        }

        if(viewMonth>8){
            viewMonth2 = viewMonth+1;
        }
        // year-month 채우기
        document.querySelector('.d-title').textContent = `${viewYear}년 ${viewMonth + 1}월`;
        document.querySelector('.d-title').dataset.ym = `${viewYear}-${viewMonth2}`;
        monthSet= `${viewYear}-${viewMonth2}`;
        // 지난 달 마지막 Date, 이번 달 마지막 Date
        const prevLast = new Date(viewYear, viewMonth, 0);
        const thisLast = new Date(viewYear, viewMonth + 1, 0);

        const PLDate = prevLast.getDate();
        const PLDay = prevLast.getDay();

        const TLDate = thisLast.getDate();
        const TLDay = thisLast.getDay();

        // Dates 기본 배열들
        const prevDates = [];
        const thisDates = [...Array(TLDate + 1).keys()].slice(1);
        const nextDates = [];

        // prevDates 계산
        if (PLDay !== 6) {
            for (let i = 0; i < PLDay + 1; i++) {
                prevDates.unshift(PLDate - i);
            }
        }

        // nextDates 계산
        for (let i = 1; i < 7 - TLDay; i++) {
            nextDates.push(i)
        }

        // Dates 합치기
        const dates = prevDates.concat(thisDates, nextDates);

        // Dates 정리
        /*
        dates.forEach((date, i) => {
          if((i+1)%7==1){
              dates[i] = `<tr><td class="date"><h5>${date}</h5><span></span></td>`;
          }else if((i+1)%7==7){
              dates[i] = `</tr><td class="date"><h5>${date}</h5><span></span></td>`;
          }else{
              dates[i] = `<td class="date"><h5>${date}</h5><span></span></td>`;
          }
        })*/
        console.log(dates)

        const firstDateIndex = dates.indexOf(1);
        const lastDateIndex = dates.lastIndexOf(TLDate);
        dates.forEach((date, i) => {
            const condition = i >= firstDateIndex && i < lastDateIndex + 1
                ? 'this'
                : 'other-month';
            if((i+1)%7==1){
                //dates[i] = `<tr><td class="date ${condition}" data-idx="${date}"><h5>${date}</h5><span></span></td>`;
                dates[i] = `<li class="day ${condition}" data-tm="${date}"><div class="date">${date}</div></li>`;
            }else if((i+1)%7==7){
                //dates[i] = `</tr><td class="date ${condition}" data-idx="${date}"><h5>${date}</h5><span></span></td>`;
                dates[i] = `<li class="day ${condition}" data-tm="${date}"><div class="date">${date}</div></li>`;
            }else{
                //dates[i] = `<td class="date ${condition}" data-idx="${date}"><h5>${date}</h5><span></span></td>`;
                dates[i] = `<li class="day ${condition}" data-tm="${date}"><div class="date">${date}</div></li>`;
            }

            //dates[i] = `<div class="date"><span class="${condition}">${date}</span></div>`;
        })

        // Dates 그리기
        document.querySelector('.dates').innerHTML = dates.join('');

        const today = new Date();

        //console.log(viewMonth)

        if (viewMonth === today.getMonth() && viewYear === today.getFullYear()) {
            for (let date of document.querySelectorAll('.this')) {
                if (+date.innerText === today.getDate()) {
                    date.classList.add('today-td');
                    break;
                }
            }
        }

        monthData();
    }

    renderCalendar();

    // ...( 생략 )...

    const prevMonth = () => {
        date.setMonth(date.getMonth() - 1);
        renderCalendar();
    }

    const nextMonth = () => {
        date.setMonth(date.getMonth() + 1);
        renderCalendar();
    }

    const goToday = () => {
        date = new Date();
        renderCalendar();
        //$('.today-td').click();
    }

    function dayData(tm){
        console.log(tm)

        let param = {
            tm : tm
        }

        $.ajax({
            url: "../php/getWorkReservation.php",
            data: param,
            method: "POST",
            async: false,
            success: function (result) {
                console.log(result)

                if(result.length>0){
                    $('#taskForm #primaryWork').val(result[0].PRIMARY_WORK)
                    $('#taskForm #amMainType').val(result[0].AM_WORK_MAIN).trigger('change')
                    $('#taskForm #pmMainType').val(result[0].PM_WORK_MAIN).trigger('change')
                    $('#taskForm #amSubType').val(result[0].AM_WORK_SUB)
                    $('#taskForm #pmSubType').val(result[0].PM_WORK_SUB)
                    $('#taskForm #workDate').val(result[0].WORK_DATE)
                }else{
                    $('#taskForm input').val('')
                    $('#taskForm #amMainType').val('미정').trigger('change')
                    $('#taskForm #pmMainType').val('미정').trigger('change')
                }
            }
        })
    }

    function monthData(){

        $('.event').remove();

        //파라미터 년-월
        let param = {
            tm : monthSet
        }

        let searchList = [];

        // Find all checked checkboxes and iterate over them
        $('#chkZone input[type=checkbox]:checked').each(function() {
            // Add the checkbox's value to the array
            searchList.push($(this).val());
        });

        console.log(monthSet)

        $.ajax({
            url : "../php/getWorkReservationMonth.php",
            data : param,
            async : false,
            success : function(result){

                $.each(result,function(index,item){
                    let day = item.WORK_DATE.split('-')[2]*1;

                    console.log(searchList);
                    console.log(searchList.some(key => item.AM_WORK_MAIN === key))
                    console.log(searchList.some(key => item.PM_WORK_MAIN === key))

                    if(item.PRIMARY_WORK!=''){
                        $('li[data-tm="' + day + '"]:not(.other-month)').append(`<div class="event event-main"><div class="event-desc m-t-20">${item.PRIMARY_WORK}</div></div>`)
                    }

                    if(searchList.some(key => item['AM_WORK_MAIN'] === key) || searchList.some(key => item['PM_WORK_MAIN'] === key)) {
                        console.log('로드')
                        let sc = `<div class="event"><div class="event-desc m-t-20">`;

                        if(item['AM_WORK_MAIN']!='미정'){
                            if(item['PM_WORK_MAIN']=='미정'){
                                sc += `(오전)`
                            }
                            sc += `${item.AM_WORK_MAIN} : ${item.AM_WORK_SUB}`;
                        }

                        if(item['PM_WORK_MAIN']!='미정'){
                            if(item['AM_WORK_MAIN']!='미정'){
                                sc += ` / `
                            }else{
                                sc += `(오후)`
                            }
                            sc += `${item.PM_WORK_MAIN} : ${item.PM_WORK_SUB}`;
                        }

                        sc += `</div></div>`

                        $('li[data-tm="' + day + '"]:not(.other-month)').append(sc)
                    }
                })
                /*
                for(var i=0;i<result;i++){
                    var schedule = "일정";
                    var event = "";
                    event += `<div class="event"><div class="event-desc m-t-20">${schedule}</div></div>`

                    $("li.day[data-tm='28']").not(".other-month").append(event);
                }*/
            }
        })

        if(!searchList.includes("fan")){
            return;
        }

        $.ajax({
            url : "../php/getFanScheduleMonth2.php",
            data : param,
            async : false,
            success : function(result){
                console.log(result);

                let eventList = [];

                //let prevNo = "";

                $.each(result,function(index,item){

                    if (eventList.length > 0 && eventList[eventList.length - 1].no === item.RESERVE_NO) {
                        // 이전 이벤트의 no와 현재 이벤트의 no가 같으면, REMOTE_CODE를 합칩니다.
                        eventList[eventList.length - 1].remoteCode += "," + item.REMOTE_NAME;

                    } else {

                        // no가 다르면 새로운 이벤트를 생성하고 추가합니다.
                        let event = {
                            no: item.RESERVE_NO,
                            startDate: item.RESERVE_START,
                            endDate: item.RESERVE_END,
                            summary: item.RESERVE_COMMENT,
                            remoteCode: item.REMOTE_NAME // 이 부분은 적절한 값으로 교체해야 합니다.
                        }

                        console.log(event)

                        eventList.push(event);
                    }

                })
                /*
                $.each(result,function(index,item){
                    let day = item.RESERVE_START.split('-')[2].substring(0,2)*1;
                    let time = item.RESERVE_START.substring(11,16);
                    //console.log(item.RESERVE_START.substring(11,16));
                    $('li[data-tm="'+day+'"]:not(.other-month)').append(`<div class="event event-fan"><div class="event-desc m-t-20">${time} ${item.RESERVE_COMMENT}</div></div>`)
                })*/

                $.each(eventList,function(index,item){
                    let day = item.startDate.split('-')[2].substring(0,2)*1;
                    let time = item.startDate.substring(11,16);
                    //console.log(item.RESERVE_START.substring(11,16));
                    $('li[data-tm="'+day+'"]:not(.other-month)').append(`<div class="event event-fan"><div class="event-desc m-t-20">${time} ${item.summary}</div></div>`)
                })
            }
        })
    }

</script>
</body>
</html>
