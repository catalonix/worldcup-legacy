<?
    session_start();
?>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <!-- Favicon -->
    <link rel="icon" href="" type="image/x-icon"/>
    <!-- Title -->
    <title>상암월드컵경기장</title>
    <!-- Bootstrap css-->
    <link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Icons css-->
    <link href="../assets/plugins/web-fonts/icons.css" rel="stylesheet"/>
    <link href="../assets/plugins/web-fonts/font-awesome/font-awesome.min.css" rel="stylesheet">
    <link href="../assets/plugins/web-fonts/plugin.css" rel="stylesheet"/>
    <!-- Style css-->
    <link href="../assets/css/style.css" rel="stylesheet">
    <link href="../assets/css/skins.css" rel="stylesheet">
    <!-- Sidemenu css-->
    <link href="../assets/css/sidemenu/sidemenu.css" rel="stylesheet">
    <link href="../assets/css/sangam.css" rel="stylesheet">
    <link href="../assets/css/twentytwenty.css" rel="stylesheet" type="text/css">
    <!-- Select2 css -->
    <link href="../assets/plugins/select2/css/select2.min.css" rel="stylesheet">
    <!--Bootstrap-datepicker css-->
    <link rel="stylesheet" href="../assets/plugins/bootstrap-datepicker/bootstrap-datepicker.css">
    <link href="../assets/plugins/spectrum-colorpicker/spectrum.css" rel="stylesheet">
    <!-- Internal Datetimepicker-slider css -->
    <link href="../assets/plugins/amazeui-datetimepicker/css/amazeui.datetimepicker.css" rel="stylesheet">
    <!-- Internal DataTables css-->
    <link href="../assets/plugins/datatable/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="../assets/plugins/datatable/responsivebootstrap4.min.css" rel="stylesheet" />
    <link href="../assets/plugins/datatable/fileexport/buttons.bootstrap4.min.css" rel="stylesheet" />
    <style>
        .setRemote{
            color : white;
            cursor: pointer;
            display: inline;
        }
        .main-toggle{
            margin: 0px auto;
        }
        .calendar-container{
            position: relative;
            max-width: 550px;
            margin: 20px auto 10px;
        }
        .calendar-container header{
            width: 550px;
            position: absolute;
        }
        .addBtn{
            border: 0;
            margin-left: 10px;
            padding: 5px 15px;
            border-radius: 5px;
            background: #3b76e1;
            color: #fff;
        }
        .cancel-button{
            border: 0;
            padding: 5px 15px;
            border-radius: 5px;
        }
        .has-event{
            color: dodgerblue;
            font-weight: bold;
        }
        .event-remove{
            cursor: pointer;
            color: black;
        }
        .card-content-list-height{
            height: 485px;
            padding-top: 35px;
        }

        .airblower-tab1 {
            position: absolute;
            top: 0px;
            left: 18%;
            display: flex;
        }
        .airblower-tab2 {
            position: absolute;
            top: 0px;
            right: 18%;
            display: flex;
        }
        .airblower-tab3 {
            position: absolute;
            bottom: 40px;
            left: 1%;
            display: flex;
        }
        .airblower-tab4 {
            position: absolute;
            bottom: 40px;
            right: 1%;
            display: flex;
        }
        .airblower-tab5 {
            position: absolute;
            bottom: 10px;
            left: 13%;
            display: flex;
            margin-bottom: 140px !important;
        }

        .airblower-tab6 {
            position: absolute;
            bottom: 20px;
            left: 7%;
            display: flex;
            margin-bottom: 70px !important;
        }

        .airblower-tab7 {
            position: absolute;
            bottom: 20px;
            right: 7%;
            display: flex;
            margin-bottom: 70px !important;
        }

        .airblower-tab8 {
            position: absolute;
            bottom: 10px;
            right: 13%;
            display: flex;
            margin-bottom: 140px !important;
        }

        .calendar .event-container .removeBtn {
            position: absolute;
            width: 50px;
            height: 30px;
            bottom: 10px;
            right: 50px;
            background: #ff5163;
            padding: 5px 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .calendar {
            grid-template-columns: unset;
        }

        @media (max-width: 768px){
            .calendar-container,.calendar-container header{
                max-width: 100%;
            }
            .calendar table {
                width: 100% !important;
            }
            .calendar td {
                padding: 0.3em 0.1em !important;
            }
            .year{
                display: none !important;
            }
            #scheduleModal .ckbox span{
                padding-left: 6px;
            }
            .mNone{
                display: none;
            }
            .modal-header{
                margin-bottom: 5px;
            }
            .modal-body{
                padding-top: 0px;
                padding-bottom: 0px;
            }
            .card-content-list-height {
                height: 390px;
                padding-top: 5px;
            }
            .event-container{
                padding-left: 25px !important;
                padding-right: 25px !important;
            }
            .calendar .event-container .removeBtn {
                right: 25px;
            }
        }
        @media (max-width: 568px){
            .event-container{
                padding-left: 15px !important;
                padding-right: 15px !important;
            }
            .calendar .event-container .removeBtn {
                right: 15px;
            }
            .calendar .event-container .event{
                line-height: 1rem;
            }

        }

        @media (max-width: 400px){
            .event-wrapper .event{
                height: 32px;
            }
        }
    </style>
</head>

<body class="main-body leftmenu">
<!-- Loader -->
<div id="global-loader">
    <img src="../assets/img/loader.svg" class="loader-img" alt="Loader">
</div>
<!-- End Loader -->
<!-- Page -->
<div class="page">
    <!-- Sidemenu -->
    <?include "../include/sidebar.php";?>
    <!-- End Sidemenu -->

    <!-- Main Header-->
    <?include "../include/header.php";?>
    <!-- End Main Header-->
    <!-- Mobile-header -->

    <!-- //Mobile-header -->
    <!-- Main Content-->
    <div class="main-content side-content pt-0">
        <div class="container-fluid main-m-pt">
            <div class="inner-body">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h2 class="main-content-title text-white tx-24 mg-b-5 font-weight-bold">원격작동 정보</h2>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item">Home</li>
                            <li class="breadcrumb-item active" aria-current="page">원격작동 정보</li>
                        </ol>
                    </div>
                </div>
                <!-- End Page Header -->
                <!--Row-->
                <div class="row row-sm mt-4">
                    <!-- col -->
                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-7">
                        <div class="card custom-card overflow-hidden">
                            <div class="card-header border-bottom-0 pb-0 mb-3">
                                <div>
                                    <div class="stadium-header">
                                        <label class="main-content-label my-auto pt-2 pb-2 tx-16">원격작동 현황</label>
                                        <div class="card-header-right">
                                            <div class="stadium-legend">
                                                <div class="legend-normal">
                                                    <div></div>
                                                    <span>작동중</span>
                                                </div>
                                                <div class="legend-weird">
                                                    <div></div>
                                                    <span>정지</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="stadium-remote-map position-relative">
                                    <img src="../assets/img/stadium-remote.png">
                                    <ul class="nav nav-tabs nav-tabs-solid nav-justified border-0">
                                        <li class="nav-item mr-2 robot-tab">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p active" data-toggle="tab" id="robot">
                                                <div class="remote-situation tab-working"></div>
                                                <span>토양로봇</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab1">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p mr-2" data-toggle="tab" id="FAN04">
                                                <div class="remote-situation tab-stop"></div>
                                                <span>쿨링팬 4</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab2">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p" data-toggle="tab" id="FAN08">
                                                <div class="remote-situation tab-working"></div>
                                                <span>쿨링팬 8</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab3">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p mr-2" data-toggle="tab" id="FAN10">
                                                <div class="remote-situation tab-working"></div>
                                                <span>쿨링팬 1</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab4">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p mr-2" data-toggle="tab" id="FAN05">
                                                <div class="remote-situation tab-working"></div>
                                                <span>쿨링팬 5</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab5">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p mr-2" data-toggle="tab" id="FAN03">
                                                <div class="remote-situation tab-working"></div>
                                                <span>쿨링팬 3</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab6">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p" data-toggle="tab" id="FAN02">
                                                <div class="remote-situation tab-stop"></div>
                                                <span>쿨링팬 2</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab7">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p mr-2" data-toggle="tab" id="FAN06">
                                                <div class="remote-situation tab-working"></div>
                                                <span>쿨링팬 6</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 airblower-tab8">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p" data-toggle="tab" id="FAN07">
                                                <div class="remote-situation tab-stop"></div>
                                                <span>쿨링팬 7</span>
                                            </a>
                                        </li>
                                        <li class="nav-item mr-2 irrigation-tab">
                                            <a href="#airblower-tab-1" class="remote-tab-link wd-100p" data-toggle="tab" id="FAN091">
                                                <div class="remote-situation tab-working"></div>
                                                <span>관수</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-5">
                        <div class="card custom-card overflow-hidden">
                            <div class="card-header border-bottom-0 pb-0">
                                <div>
                                    <div class="d-flex-sb">
                                        <label class="main-content-label my-auto pt-2 pb-2 tx-16">원격작동 상세정보</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="tab-content mb-3">
                                    <div class="tab-pane fade active show" id="airblower-tab-1">
                                        <div class="remote-info">
                                            <div class="remote-title">
                                                <div class="title-icon-box mr-2">
                                                    <img src="../assets/img/airblower-icon.png">
                                                </div>
                                                <h2 id="remoteName">쿨링팬 1</h2>
                                                <!--
                                                <div class="remote-situation-data">
                                                    <span class="condition-normal"></span>
                                                    <h4>작동중</h4>
                                                </div>
                                                -->
                                            </div>
                                            <h4>
                                                <span class="recent-time">최근 가동 : 2022.11.14 22:13</span>
                                                <span>│</span>
                                                <span class="reservation-time">예약 가동 : 2022.11.14 22:25</span>
                                            </h4>
                                        </div>
                                        <div class="remote-time">
                                            <div class="remote-time-info">
                                                <span>작동시간</span>
                                                <h4 id="time">5분</h4>
                                            </div>
                                            <div class="remote-time-info">
                                                <span>작동현황</span>
                                                <h4 id="state" class="off">정지</h4>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-8">
                        <div class="card custom-card overflow-hidden">
                            <div class="card-header border-bottom-0 pb-0">
                                <div>
                                    <div class="d-flex-sb2 border-bottom">
                                        <label class="main-content-label my-auto pt-2 pb-4 tx-16">작동현황 리스트</label>
                                        <div class="add-modal-btn">
                                            <button class="trigger"><i class="fe fe-settings mr-2"style="vertical-align: middle;"></i>원격작동 일정관리</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <h5 class="modal-info remote-table-header">
                                    <span>원하시는 장비에 원격작동 설정을 해주세요.</span>
                                    <!--<label class="ckbox">
                                        <input type="checkbox">
                                        <span>모두 정지</span>
                                    </label>-->
                                    <span id="allStop" style="cursor: pointer">모두 정지</span>
                                </h5>
                                <div class="table-responsive">
                                    <table class="table text-nowrap text-md-nowrap table-bordered mg-b-0" id="stateTable">
                                        <thead>
                                        <tr class="text-center">
                                            <th>장비명</th>
                                            <th>작동 현황</th>
                                            <th>다음 작동 예약일시</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr class="text-center trigger2" data-fanid="robot" style="display: none">
                                            <td>토양로봇</td>
                                            <td><span class="working-box working">작동중</span></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN091" style="display: none">
                                            <td>관수</td>
                                            <td><span class="working-box working">작동중</span></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN10">
                                            <td>쿨링팬 1</td>
                                            <td>
                                                <div class="main-toggle main-toggle-success on">
                                                    <span></span>
                                                </div>
                                            </td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN02">
                                            <td>쿨링팬 2</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN03">
                                            <td>쿨링팬 3</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN04">
                                            <td>쿨링팬 4</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN05">
                                            <td>쿨링팬 5</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN06">
                                            <td>쿨링팬 6</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN07">
                                            <td>쿨링팬 7</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN08">
                                            <td>쿨링팬 8</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        <tr class="text-center" data-fanid="FAN99_ON">
                                            <td>쿨링팬 테스트</td>
                                            <td><div class="main-toggle main-toggle-success on">
                                                <span></span></div></td>
                                            <td>-</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- col end -->
                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-4" id="connectTable" style="">
                        <div class="card custom-card overflow-hidden">
                            <div class="card-header border-bottom-0 pb-0 mb-2">
                                <div>
                                    <div class="d-flex-sb">
                                        <label class="main-content-label my-auto pt-2 tx-16">연결상태</label>
                                        <div class="title-icon-box">
                                            <img src="../assets/img/airblower-icon.png">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="card-content card-content-list-height">
                                    <div class="card-condition-list" data-fanid="FAN10">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-1</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN02">
                                        <div class="condition-list-title">
                                            <span class="condition-weird"></span>
                                            <h4>쿨링팬-2</h4>
                                        </div>
                                        <p class="progress-step">OFF / -</p>
                                        <div class="condition-text-box situation-danger">
                                            <span>OFFLINE</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN03">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-3</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN04">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-4</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN05">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-5</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN06">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-6</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN07">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-7</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                    <div class="card-condition-list" data-fanid="FAN08">
                                        <div class="condition-list-title">
                                            <span class="condition-normal"></span>
                                            <h4>쿨링팬-8</h4>
                                        </div>
                                        <p class="progress-step">ON</p>
                                        <div class="condition-text-box situation-success">
                                            <span>정상</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Row end -->
            </div>
        </div>
    </div>
    <!-- End Main Content-->
    <!-- modal content -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content wd-40p">
            <div class="modal-header">
                <h3>원격작동 일정관리</h3>
                <span class="close-button">×</span>
            </div>
            <div class="modal-body">
                <h5 class="modal-info remote-table-header">
                    <span class="mNone">장비 선택 후 일정을 확인/입력 해주세요.</span>
                </h5>
                <h5 class="modal-info remote-table-header" style="flex-direction: row">
                    <span class="mNone">쿨링팬 번호</span>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN10" checked="checked">
                        <span>1</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN02" checked="checked">
                        <span>2</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN03" checked="checked">
                        <span>3</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN04" checked="checked">
                        <span>4</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN05" checked="checked">
                        <span>5</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN06" checked="checked">
                        <span>6</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN07" checked="checked">
                        <span>7</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN08" checked="checked">
                        <span>8</span>
                    </label>
                    <label class="ckbox">
                        <input type="checkbox" name="remoteCode[]" value="FAN99_ON">
                        <span>테스트</span>
                    </label>
                </h5>
                <div id="calendar2" class="calendar-container">

                </div>
                <div class="modal-btn" style="margin-top: 10px;display: block">
                    <div style="display:inline-block;width: 100%">
                        <input class="form-control fc-datepicker2" placeholder="시작일" type="text" id="startDate" style="width: 140px;display:inline-block">
                        <input class="form-control" placeholder="시간" type="time" id="startTime" style="width: 140px;display:inline-block">
                        <input type="text" class="form-control" id="minute" placeholder="작동(분)" value="30" style="width: 80px;display: inline-block;">
                        <input type="text" class="form-control" id="comment" placeholder="설명을 입력하세요." style="width: 200px;display: inline-block;">
                        <button class="addBtn" type="button">추가</button>
                        <button style="display:inline-block;" type="button" class="btn-bg3 cancel-button">닫기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /modal content -->
    <!-- Main Footer-->
    <div class="main-footer text-center">
        <div class="container">
            <div class="row row-sm">
                <div class="col-md-12">
                    <span class="text-white">Copyright © 2023 <a style="color: #80b9ed;">상암월드컵경기장</a></span>
                </div>
            </div>
        </div>
    </div>
    <!--End Footer-->
</div>
<!-- End Page -->

<!-- Back-to-top -->
<a href="#top" id="back-to-top"><i class="fe fe-arrow-up"></i></a>

<link rel="stylesheet" href="../assets/plugins/simple-calendar/simple-calendar.css?ver=4">
<script src="../assets/plugins/simple-calendar/simple-calendar.js?ver=4"/>
<!-- Jquery js-->
<script src="../assets/plugins/jquery/jquery.min.js"></script>

<!-- Bootstrap js-->
<script src="../assets/plugins/bootstrap/js/popper.min.js"></script>
<script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>

<!-- Peity js-->
<script src="../assets/plugins/peity/jquery.peity.min.js"></script>
<!-- Internal Jquery-Ui js-->
<script src="../assets/plugins/jquery-ui/ui/widgets/datepicker.js"></script>
<!-- Select2 js-->
<script src="../assets/plugins/select2/js/select2.min.js"></script>
<!-- Internal Chart.Bundle js-->
<script src="../assets/plugins/chart.js/Chart.bundle.min.js"></script>
<!-- Internal Jquery.maskedinput js-->
<script src="../assets/plugins/jquery.maskedinput/jquery.maskedinput.js"></script>
<!-- Sidemenu js -->
<script src="../assets/plugins/sidemenu/sidemenu.js"></script>

<!-- Internal Specturm-colorpicker js-->
<script src="../assets/plugins/spectrum-colorpicker/spectrum.js"></script>
<!-- Select2 js-->
<script src="../assets/plugins/select2/js/select2.min.js"></script>
<script src="../assets/js/select2.js"></script>
<!--Bootstrap-datepicker js-->
<script src="../assets/plugins/bootstrap-datepicker/bootstrap-datepicker.js"></script>
<!-- Internal jquery-simple-datetimepicker js -->
<script src="../assets/plugins/amazeui-datetimepicker/js/amazeui.datetimepicker.min.js"></script>

<!-- Internal Data Table js -->
<script src="../assets/plugins/datatable/jquery.dataTables.min.js"></script>
<script src="../assets/plugins/datatable/dataTables.bootstrap4.min.js"></script>
<script src="../assets/plugins/datatable/dataTables.responsive.min.js"></script>
<script src="../assets/plugins/datatable/fileexport/dataTables.buttons.min.js"></script>
<script src="../assets/plugins/datatable/fileexport/buttons.bootstrap4.min.js"></script>
<script src="../assets/js/table-data.js"></script>
<!-- Internal Dashboard js-->
<script src="../assets/js/crypto-exchange.js"></script>
<!-- Internal Form-elements js-->
<script src="../assets/js/form-elements.js"></script>
<!-- Sticky js -->
<script src="../assets/js/sticky.js"></script>
<!-- twentytwenty -->
<script src="../assets/js/jquery.event.move.js"></script>
<script src="../assets/js/jquery.twentytwenty.js"></script>
<!-- Custom js -->
<script src="../assets/js/custom.js?ver=2"></script>
<script>

    function getKstTime(utcDates){

        let utcDate = new Date(utcDates);
        // 9시간을 밀리초로 변환 (1시간 = 60분 = 3600초 = 3600000 밀리초)
        /*let nineHours = 24 * 60 * 60 * 1000;

        // 주어진 UTC 시간에 9시간을 더하기
        utcDate.setTime(utcDate.getTime() + nineHours);*/

        // 한국 시간(KST)으로 변환하기
        let kstDate = new Date(utcDate.getTime() + (utcDate.getTimezoneOffset() + 540) * 60000);

        // 결과 출력 형식에 맞추기
        let resultDate = kstDate.toISOString().split("T")[0] + " " + kstDate.toTimeString().split(" ")[0];

        return resultDate;
    }
    function getFanState(fanId){

        var param = {
            url : "https://seoul-api.fieldon.io/api/states/"+fanId,
            auth : "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiIzYjhiYWY3NmFjYjE0ZjM1YTgwYmU4YTZjODRjNDI2YiIsImlhdCI6MTY3MDU3OTQwMCwiZXhwIjoxOTg1OTM5NDAwfQ.OuC-DCFJ4pXOPap_zh2j0zVGqC04X9TEQTnRPzsu1uQ"
        }

        $.ajax({
            type: "POST",
            url: "../php/curl.php",
            data : param,
            dataType : "json",
            success: function (res) {
                //console.log(res)

                if(!res.attributes){
                    return;
                }

                let fanId = res.attributes.friendly_name.replace("_STATUS","");

                $('#'+fanId+" .remote-situation").removeClass("tab-working")
                $('#'+fanId+" .remote-situation").removeClass("tab-stop")

                if(res.state=='on'){
                    $('#'+fanId+" .remote-situation").addClass("tab-working")
                    $('#stateTable [data-fanid="'+fanId+'"] .working-box').text("작동중");
                    $('#stateTable [data-fanid="'+fanId+'"] .working-box').attr("class","working-box working");

                    $('#state').attr('class','on')
                    $('#state').text('작동중')

                    $(`#stateTable tbody tr[data-fanid="${fanId}"] .main-toggle`).addClass('on')
                }else{
                    $('#'+fanId+" .remote-situation").addClass("tab-stop")
                    $('#stateTable [data-fanid="'+fanId+'"] .working-box').text("정지");
                    $('#stateTable [data-fanid="'+fanId+'"] .working-box').attr("class","working-box stop");

                    $(`#stateTable tbody tr[data-fanid="${fanId}"] .main-toggle`).removeClass('on')

                    $('#state').attr('class','off')
                    $('#state').text('정지')

                    console.log(fanId)
                }
                //console.log(res.state);
                let last = getKstTime(res.last_changed)//.substring(0,16).replace('T',' ');
                $('#remoteTable tbody tr[data-fanid="'+fanId+'"] td:eq(3)').html(last+`<input type="hidden" name="currentOper[]" value="${last}">`)

                $('.recent-time').text("최근 가동 : "+last);

            }
        });
    }

    function getFanConnectState(fanId){

        var param = {
            url : "https://seoul-api.fieldon.io/api/states/"+fanId,
            auth : "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiIzYjhiYWY3NmFjYjE0ZjM1YTgwYmU4YTZjODRjNDI2YiIsImlhdCI6MTY3MDU3OTQwMCwiZXhwIjoxOTg1OTM5NDAwfQ.OuC-DCFJ4pXOPap_zh2j0zVGqC04X9TEQTnRPzsu1uQ"
        }

        $.ajax({
            type: "POST",
            url: "../php/curl.php",
            data : param,
            dataType : "json",
            success: function (res) {
                console.log(res)
                let fanId = res.attributes.friendly_name.replace("_STATUS","");

                if(res.state=='on'){
                    $('#connectTable [data-fanid="'+fanId+'"] .progress-step').text("ON");
                    $('#connectTable [data-fanid="'+fanId+'"] .condition-list-title span').attr('class','condition-normal');
                    $('#connectTable [data-fanid="'+fanId+'"] .condition-text-box').attr('class','condition-text-box situation-success');
                    $('#connectTable [data-fanid="'+fanId+'"] .condition-text-box span').text("정상")
                }else{
                    $('#connectTable [data-fanid="'+fanId+'"] .progress-step').text("OFF / "+res.state.toUpperCase());
                    $('#connectTable [data-fanid="'+fanId+'"] .condition-list-title span').attr('class','condition-weird');
                    $('#connectTable [data-fanid="'+fanId+'"] .condition-text-box').attr('class','condition-text-box situation-danger');
                    $('#connectTable [data-fanid="'+fanId+'"] .condition-text-box span').text("OFFLINE")
                }
                //console.log(res.state);
            }
        });
    }
    function updateFanState(fanId,onoff){

        <?
            if($_SESSION["userCode"]!='1'){
                echo 'alert("권한이 부족합니다.");location.reload();return;';
            }
        ?>

        let origin = fanId;
        //console.log(fanId);
        //fanId = "switch.fan99_on"
        if(fanId!="fan99_on"){
            fanId = fanId+"_on"
        }

        let param = {
            url : "https://seoul-api.fieldon.io/api/services/switch/turn_"+onoff,
            auth : "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiIzYjhiYWY3NmFjYjE0ZjM1YTgwYmU4YTZjODRjNDI2YiIsImlhdCI6MTY3MDU3OTQwMCwiZXhwIjoxOTg1OTM5NDAwfQ.OuC-DCFJ4pXOPap_zh2j0zVGqC04X9TEQTnRPzsu1uQ",
            entity : fanId
        }

        $.ajax({
            type: "GET",
            url: "../php/curl2.php",
            data : param,
            dataType : "json",
            success: function (res) {
                //console.log('aaaa')
                console.log(res)
                //console.log(res.state);
                //location.reload();
            },
            complete: function (){
                //setTimeout(() => getFanState("binary_sensor."+origin+"_status"), 1400);
            }
        });
    }

    $(document).ready(function(){
        $(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct: 0.5});
        $(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct: 0.5, orientation: 'vertical'});
        $("#sensorBtn-1").click(function(){
            $("#sensorDate-1").toggle();
            $("#infoBox").toggle();
        });

        $("#addContact").on("click", function() {
            $("#more-contact").append("<div class='form-group'><input type='text' class='form-control' id='' placeholder=''/></div>");
        });
        $("#removeContact").on("click", function() {
            $("#more-contact").children().last().remove();
        });

        var modal = document.querySelector(".modal");
        var trigger = document.querySelector(".trigger");
        var closeButton = document.querySelector(".close-button");
        var cancelButton = document.querySelector(".cancel-button");

        function toggleModal() {
            modal.classList.toggle("show-modal");
        }

        function windowOnClick(event) {
            if (event.target === modal) {
                toggleModal();
            }
        }

        function validateNumber(input) {
            if (input.value < 0) {
                input.value = 0;
            }
        }

        function nextCalc(input){
            var interval = input.value;

            var current = $(input).closest('tr').find('td:eq(3)').text()+":00";

            var next = calculateTime(current,interval*60);

            $(input).closest('tr').find('td:eq(4)').html(next+`<input type="hidden" name="nextOper[]" value="${next}">`)
        }

        function calculateTime(timeString, firstPlace) {
            // 입력된 시간 문자열을 Date 객체로 변환
            const time = new Date(timeString);

            // 1등 시간에 대한 밀리초 값 계산
            const firstPlaceTime = new Date(time);
            firstPlaceTime.setHours(firstPlaceTime.getHours() + Math.floor(firstPlace / 60));
            firstPlaceTime.setMinutes(firstPlaceTime.getMinutes() + (firstPlace % 60));

            // 결과값을 "yyyy-MM-dd HH:mm" 형식의 문자열로 변환
            const formatTime = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}`;
            };

            // 결과값 반환
            return formatTime(firstPlaceTime);
        }

        $('#stateTable tbody tr .main-toggle').on('click',function(){
            let fanid = $(this).closest('tr').data('fanid')
            let state = $(this).hasClass('on')
            //console.log(state);
            /*
            if(fanid=="robot" || fanid=="FAN091"){
                alert('현재 지원중이 아닙니다. 쿨링팬만 진행해주세요.')
                return;
            }*/

            if(state==true){
                updateFanState(fanid.toLowerCase(),'on');
                //getFanState("binary_sensor."+fanid.toLowerCase()+"_status");
            }else{
                updateFanState(fanid.toLowerCase(),"off");
                //getFanState("binary_sensor."+fanid.toLowerCase()+"_status");
            }
            //console.log(fanid);
            //updateFanState("switch."+fanid.toLowerCase()+"_on");
            //updateFanState(fanid)
        })

        trigger.addEventListener("click", toggleModal);
        closeButton.addEventListener("click", toggleModal);
        window.addEventListener("click", windowOnClick);
        cancelButton.addEventListener("click", toggleModal);

        /*getFanState("switch.fan01");
        getFanState("switch.fan02");
        getFanState("switch.fan03");
        getFanState("switch.fan04");
        getFanState("switch.fan05");
        getFanState("switch.fan06");
        getFanState("switch.fan07");
        getFanState("switch.fan08");
        getFanState("switch.fan09");
        getFanState("switch.fan10");*/
        getFanState("switch.fan99_on");
        getFanState("binary_sensor.fan10_status");
        getFanState("binary_sensor.fan02_status");
        getFanState("binary_sensor.fan03_status");
        getFanState("binary_sensor.fan04_status");
        getFanState("binary_sensor.fan05_status");
        getFanState("binary_sensor.fan06_status");
        getFanState("binary_sensor.fan07_status");
        getFanState("binary_sensor.fan08_status");

        //getFanState("binary_sensor.fan99_status");

        getFanState("person.robot");
        //getFanState("binary_sensor.fan09_status");
        //getFanState("binary_sensor.fan10_status");

        getFanConnectState("binary_sensor.fan10");
        getFanConnectState("binary_sensor.fan02");
        getFanConnectState("binary_sensor.fan03");
        getFanConnectState("binary_sensor.fan04");
        getFanConnectState("binary_sensor.fan05");
        getFanConnectState("binary_sensor.fan06");
        getFanConnectState("binary_sensor.fan07");
        getFanConnectState("binary_sensor.fan08");

        //getRemoteInfo();

        $('input[name="workInterval[]"]').on('input', function() {
            validateNumber(this);
            nextCalc(this)
        });

        $('.stadium-remote-map .remote-tab-link').on('click',function(){
            var remoteCode = $(this).attr('id');

            var next = $('#stateTable [data-fanid="'+remoteCode+'"] td:eq(2)').text();
            var minute = $('#stateTable [data-fanid="'+remoteCode+'"] td:eq(2)').data('minute');

            $('.reservation-time').text("예약 가동 : "+next);

            if(minute) {
                $('#time').html(minute + "분")
            }else{
                $('#time').html("-분")
            }
            getFanState("binary_sensor." + remoteCode.toLowerCase() + "_status");

            $('#remoteName').text($(this).find('span').text())
            /*$.ajax({
                url : "../php/getRemoteOne.php",
                data : "remoteCode="+remoteCode,
                success : function(result){
                    console.log(result)
                    $('#airblower-tab-1 #interval').text(result.WORK_INTERVAL+"시간");
                    $('#airblower-tab-1 #time').text(result.WORK_INTERVAL+"분");

                    //$('.recent-time').text("최근 가동 : "+result.CURRENT_OPER);
                    $('.reservation-time').text("예약 가동 :"+result.NEXT_OPER);

                    $('#remoteName').text(result.REMOTE_NAME)

                    //../assets/img/robot-icon.png

                    //../assets/img/watering-icon.png

                    //../assets/img/airblower-icon.png
                    if(remoteCode=='robot'){
                        $('.title-icon-box img').attr('src','../assets/img/robot-icon.png')
                    }else if(remoteCode=='FAN091'){
                        $('.title-icon-box img').attr('src','../assets/img/watering-icon.png')
                    }else{
                        $('.title-icon-box img').attr('src','../assets/img/airblower-icon.png')
                    }

                    if(remoteCode!="robot") {
                        getFanState("binary_sensor." + remoteCode.toLowerCase() + "_status");
                    }else{
                        getFanState("person.robot");
                    }
                }
            })*/

        })

        $('.stadium-remote-map .remote-tab-link:eq(1)').click();

        //updateFanState('aa')

        let $calendar;
        let container = $("#calendar2").simpleCalendar({
            fixedStartDay: 0, // begin weeks by sunday
            disableEmptyDetails: true,
            events: [
                // generate new event after tomorrow for one hour
                {
                    startDate: new Date(new Date().setHours(new Date().getHours() + 24)).toDateString(),
                    endDate: new Date(new Date().setHours(new Date().getHours() + 25)).toISOString(),
                    summary: 'Visit of the Eiffel Tower'
                },
                // generate new event for yesterday at noon
                {
                    startDate: new Date(new Date().setHours(new Date().getHours() - new Date().getHours() - 12, 0)).toISOString(),
                    endDate: new Date(new Date().setHours(new Date().getHours() - new Date().getHours() - 11)).getTime(),
                    summary: 'Restaurant'
                },
                // generate new event for the last two days
                {
                    startDate: new Date(new Date().setHours(new Date().getHours() - 48)).toISOString(),
                    endDate: new Date(new Date().setHours(new Date().getHours() - 24)).getTime(),
                    summary: 'Visit of the Louvre'
                }
            ],

        });
        $calendar = container.data('plugin_simpleCalendar')

        // JSON 데이터를 가져옵니다.
        let jsonData = {
            "dateString": "2023-07-07 12:30"
        };

        // JSON 객체에서 날짜 문자열을 추출합니다.
        let dateString = jsonData.dateString;

        // 날짜 문자열을 Date 객체로 변환합니다.
        let dateObject = new Date(dateString);

        $calendar.addEvent({startDate:dateObject,endDate:dateObject,summary:"팬 가동"});

        function isValidDateFormat(str) {
            // 정규 표현식
            var regex = /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/;

            // str가 정규 표현식에 맞는지 확인
            if(!regex.test(str)) return false;

            // Date 객체 생성을 통해 날짜의 유효성 검증
            var d = new Date(str);
            if (Number.isNaN(d.getTime())) return false;

            // 모든 검사를 통과하면 true 반환
            return true;
        }

        function getFanScheduleNext(){

            $('#stateTable tr td:nth-child(3)').html('-')

            $.ajax({
                url : "../php/getFanScheduleNext2.php",
                success : function(result){
                    console.log(result)

                    $.each(result,function(index,item){
                        $('#stateTable [data-fanid="'+item.REMOTE_CODE+'"] td:eq(2)').html(item.RESERVE_START)
                        $('#stateTable [data-fanid="'+item.REMOTE_CODE+'"] td:eq(2)').data('minute',item.RESERVE_TIME);
                    })

                }
            })
        }

        getFanScheduleNext()

        function insertFanSchedule(param){
            $.ajax({
                url : "../php/insertFanSchedule2.php",
                data : param,
                method : "POST",
                success : function(){
                    alert('스케줄이 추가되었습니다.')
                },
                complete: function(){
                    getFanSchedule();
                    getFanScheduleNext();
                    $('.event-container .close').click();
                }
            })
        }

        function removeFanSchedule(no){
            let param = {
                no : no
            }

            $.ajax({
                url : "../php/removeFanSchedule2.php",
                data : param,
                method : "POST",
                success : function(){
                    alert('스케줄이 삭제되었습니다.')
                },
                complete : function(){
                    getFanSchedule();
                    getFanScheduleNext();
                    $('.event-container .close').click();
                }
            })
        }

        function removeFanScheduleList(param){

            $.ajax({
                url : "../php/removeFanScheduleList.php",
                data : param,
                method : "POST",
                success : function(){
                    alert('스케줄이 삭제되었습니다.')
                },
                complete : function(){
                    getFanSchedule();
                    getFanScheduleNext();
                    $('.event-container .close').click();
                }
            })
        }

        function getFanSchedule(){
            var param = $('#scheduleModal input[name="remoteCode[]"]').serialize();

            $.ajax({
                url : "../php/getFanSchedule2.php",
                data : param,
                method : "GET",
                async : false,
                success : function(result){
                    console.log(result)

                    let eventList = [];

                    //let prevNo = "";

                    $.each(result,function(index,item){

                        let dateObject = new Date(item.RESERVE_START);
                        let dateObject2 = new Date(item.RESERVE_END);
                        let screenWidth = window.innerWidth;

                        if (eventList.length > 0 && eventList[eventList.length - 1].no === item.RESERVE_NO) {
                            // 이전 이벤트의 no와 현재 이벤트의 no가 같으면, REMOTE_CODE를 합칩니다.
                            // 모바일처리
                            //if(screenWidth<550){
                            item.REMOTE_NAME = item.REMOTE_NAME.replace('쿨링팬','');
                            //}

                            eventList[eventList.length - 1].remoteCode += "," + item.REMOTE_NAME;

                        } else {

                            // 모바일처리
                            if(screenWidth<550){
                                item.REMOTE_NAME = item.REMOTE_NAME.replace('쿨링','');
                            }

                            // no가 다르면 새로운 이벤트를 생성하고 추가합니다.
                            let event = {
                                no: item.RESERVE_NO,
                                startDate: dateObject,
                                endDate: dateObject2,
                                summary: item.RESERVE_COMMENT,
                                remoteCode: item.REMOTE_NAME // 이 부분은 적절한 값으로 교체해야 합니다.
                            }

                            console.log(event)

                            eventList.push(event);
                        }

                    })

                    $calendar.setEvents(eventList);

                }
            })
        }

        getFanSchedule()

        /*
        $('#remoteCode').on('change',function() {
            $('.event-container .close').click();
            getFanSchedule()
        })*/

        $('#scheduleModal input[type="checkbox"]').on('change',function(){
            $('.event-container .close').click();
            getFanSchedule();
            //console.log();
        })

        $('.addBtn').on('click',function(){

            if($('#startDate').val()=='' || $('#startTime').val()==''){
                alert('날짜/시간이 입력되지 않았습니다.')
                return;
            }

            let dateString = $('#startDate').val() +" "+$('#startTime').val();
            let dateObject = new Date(dateString);

            if(!isValidDateFormat(dateString)){
                alert('유효하지 않은 날짜 형식입니다.')
                return;
            }

            if(Date.now()>dateObject.getTime()){
                alert('선택한 날짜가 현재 시간보다 이전입니다.')
                return;
            }

            if($('#minute').val()=='' || isNaN($('#minute').val())){
                alert('작동시간을 분단위로 입력해주세요.')
                return;
            }

            let comment = $('#comment').val();

            if(!comment){
                comment = "쿨링팬 가동"
            }

            let remoteCodes = $('input[name="remoteCode[]"]:checked').map(function() {
                return $(this).val();
            }).get();

            let param = {
                remoteCode : remoteCodes,
                reserveStart : dateString,
                reserveEnd : dateString,
                reserveTime : $('#minute').val(),
                reserveComment : comment
            }

            console.log(param)

            insertFanSchedule(param);
        })

        $(document).on('click','.event-remove',function(){
            let chk = confirm('해당 스케줄을 지우시겠습니까?')
            if(chk){
                let no = $(this).closest(".event").data('no');
                removeFanSchedule(no);
            }
        })

        $(document).on('click','.removeBtn',function(){
            let chk = confirm('선택된 스케줄들을 지우시겠습니까?')
            if(chk){
                let removeList = $(this).closest('.event-container').find('input[name="removeList[]"]:checked').map(function() {
                    return $(this).val();
                }).get();

                let param = {
                    removeList : removeList
                }

                console.log(param)

                removeFanScheduleList(param);
                //let no = $(this).closest(".event").data('no');
                //removeFanSchedule(no);
            }
        })

        $(document).on('click','#allStop',function(){
            let chk = confirm('모든 쿨링팬을 정지하시겠습니까?')

            if(chk){
                updateFanState("fan02".toLowerCase(),"off");
                updateFanState("fan03".toLowerCase(),"off");
                updateFanState("fan04".toLowerCase(),"off");
                updateFanState("fan05".toLowerCase(),"off");
                updateFanState("fan06".toLowerCase(),"off");
                updateFanState("fan07".toLowerCase(),"off");
                updateFanState("fan08".toLowerCase(),"off");
                updateFanState("fan10".toLowerCase(),"off");

                $('.main-toggle-success').removeClass('on')
            }
        })
    });
</script>
</body>
</html>