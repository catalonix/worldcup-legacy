<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="keywords" content="">
		<!-- Favicon -->
		<link rel="icon" href="" type="image/x-icon"/>
		<!-- Title -->
		<title>상암월드컵경기장</title>
		<!-- Bootstrap css-->
		<link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
		<!-- Icons css-->
		<link href="../assets/plugins/web-fonts/icons.css" rel="stylesheet"/>
		<link href="../assets/plugins/web-fonts/font-awesome/font-awesome.min.css" rel="stylesheet">
		<link href="../assets/plugins/web-fonts/plugin.css" rel="stylesheet"/>
		<!-- Style css-->
		<link href="../assets/css/style.css" rel="stylesheet">
		<link href="../assets/css/skins.css" rel="stylesheet">
		<!-- Sidemenu css-->
		<link href="../assets/css/sidemenu/sidemenu.css" rel="stylesheet">
		<link href="../assets/css/sangam.css" rel="stylesheet">
		<link href="../assets/css/twentytwenty.css" rel="stylesheet" type="text/css">
		<style type="text/css">
			.spider1{
				font-size: 15px;
				font-weight: bold;
				color: blue;
				fill: white;
				text-align: center;
			}
		</style>
	</head>

	<body class="main-body leftmenu">
		<!-- Loader -->
		<div id="global-loader">
			<img src="../assets/img/loader.svg" class="loader-img" alt="Loader">
		</div>
		<!-- End Loader -->
		<!-- Page -->
		<div class="page">
			<!-- Sidemenu -->
			<?include "../include/sidebar.php";?>
			<!-- End Sidemenu -->

			<!-- Main Header-->
			<?include "../include/header.php";?>
			<!-- End Main Header-->
			<!-- Main Content-->
			<div class="main-content side-content pt-0">
				<div class="container-fluid main-m-pt">
					<div class="inner-body">
						<!-- Page Header -->
						<div class="page-header">
							<div>
								<h2 class="main-content-title text-white tx-24 mg-b-5 font-weight-bold">식생지수 정보</h2>
								<ol class="breadcrumb">
									<li class="breadcrumb-item">Home</li>
									<li class="breadcrumb-item active" aria-current="page">요약분석 정보</li>
									<li class="breadcrumb-item active" aria-current="page">식생지수 정보</li>
								</ol>
							</div>
						</div>
						<!-- End Page Header -->
						<!--Row-->
						<div class="row row-sm mt-4">
							<!-- col -->
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<div>
											<div class="d-flex-sb border-bottom">
												<label class="main-content-label my-auto pt-2 pb-2 tx-16">상세검색</label>
											</div>
										</div>
									</div>
									<div class="card-body">
										<div class="row row-sm">
											<div class="col-sm-12 col-lg-3 col-xl-2 margin-responsive">
												<select class="form-control" id="sensorNo">
													<option value="C001">동측 카메라</option>
													<option value="C002">남측 카메라</option>
													<option value="C003">서측 카메라</option>
												</select>
											</div>
											<div class="col-12 col-sm-12 col-lg-12 col-xl-6 observation-submit">
												<button class="btn ripple btn-bg pd-x-20" type="button" value="" id="searchBtn">
													<i class="fe fe-search mr-2" style="vertical-align: inherit;"></i>조회하기
												</button>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- col end -->
							<!-- col -->
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-7">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<div>
											<div class="d-flex-sb">
												<label class="main-content-label my-auto pt-2 tx-16">식생지수</label>
											</div>
										</div>
									</div>
									<div class="card-body pt-1">
										<div class="ndvi-value">
											<div class="ndvi-now">
												<h5>현재 식생지수</h5>
												<div class="now-value">
													<h4 id="ndvi1">0.611</h4>
													<span class="situation-success">양호</span>
												</div>
											</div>
											<div class="ndvi-prediction">
												<h5>예측 식생지수</h5>
												<div class="prediction-value">
													<h4 id="ndvi2">0.418</h4>
													<span class="situation-success">양호</span>
												</div>
											</div>
										</div>
										<div class="col-xl-12 col-md-12 col-sm-12 p-0 mb-3">
											<div class="twentytwenty-wrapper twentytwenty-horizontal">
												<div class="twentytwenty-container">
													<img id="ndviImg1" src="https://seoul.fieldon.io/data/C001/catalonix_show_daily_img.jpg" class="ndvi-img twentytwenty-before" width="100%">
													<img id="ndviImg2" src="https://seoul.fieldon.io/data/C001/catalonix_show_ma5_img.jpg" class="ndvi-img twentytwenty-after" width="100%">
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							
							<!--
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-5">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<div>
											<div class="d-flex-sb">
												<label class="main-content-label my-auto pt-2 tx-16">상태평가</label>
											</div>
										</div>
									</div>
									<div class="card-body pt-1">
										<div class="ndvi-chart" id="spiderChart" style="width: 100%;height: 300px;padding: 0px;">

										</div>
										<div class="ndvi-info">
											<div class="state-info">
												<h4>
													<span>식생지수</span>
												</h4>
												<span class="situation-success">양호</span>
											</div>
											<div class="state-info">
												<h4>
													<span>토양수분</span>
												</h4>
												<span class="situation-success">양호</span>
											</div>
										</div>
									</div>
								</div>
							</div>
							-->
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-5">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<div>
											<div class="d-flex-sb">
												<label class="main-content-label my-auto pt-2 tx-16">지수변화</label>
											</div>
										</div>
									</div>
									<div class="card-body pt-1">
										<canvas id="chartZone" height="500px;"></canvas>
									</div>
								</div>
							</div>
							<!-- col end -->
						</div>
						
						<!-- Row end -->
					</div>
				</div>
			</div>
			<!-- End Main Content-->
			<!-- Main Footer-->
			<div class="main-footer text-center">
				<div class="container">
					<div class="row row-sm">
						<div class="col-md-12">
							<span class="text-white">Copyright © 2023 <a style="color: #80b9ed;">상암월드컵경기장</a></span>
						</div>
					</div>
				</div>
			</div>
			<!--End Footer-->
		</div>
		<!-- End Page -->

		<!-- Back-to-top -->
		<a href="#top" id="back-to-top"><i class="fe fe-arrow-up"></i></a>

		<!-- Jquery js-->
		<script src="../assets/plugins/jquery/jquery.min.js"></script>

		<!-- Bootstrap js-->
		<script src="../assets/plugins/bootstrap/js/popper.min.js"></script>
		<script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>

		<!-- Peity js-->
		<script src="../assets/plugins/peity/jquery.peity.min.js"></script>

		<!-- Select2 js-->
		<script src="../assets/plugins/select2/js/select2.min.js"></script>
		<!-- Internal Chart.Bundle js-->
		<script src="../assets/plugins/chart.js/Chart.bundle.min.js"></script>
		<!-- Internal Jquery.maskedinput js-->
		<script src="../assets/plugins/jquery.maskedinput/jquery.maskedinput.js"></script>
		<!-- Sidemenu js -->
		<script src="../assets/plugins/sidemenu/sidemenu.js"></script>
		<!-- Internal Dashboard js-->
		<script src="../assets/js/crypto-exchange.js"></script>
		<!-- Internal Form-elements js-->
		<script src="../assets/js/form-elements.js"></script>
		<!-- Sticky js -->
		<script src="../assets/js/sticky.js"></script>
		<!-- twentytwenty -->
		<script src="../assets/js/jquery.event.move.js"></script>
		<script src="../assets/js/jquery.twentytwenty.js"></script>
		<script>
			$(function(){
				$(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct: 0.5});
				$(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct: 0.5, orientation: 'vertical'});
			});
		</script>
		<!-- Custom js -->
		<script src="../assets/js/custom.js"></script>
		<script src="https://code.highcharts.com/highcharts.js"></script>
		<script src="https://code.highcharts.com/highcharts-more.js"></script>
		<script>
			function spiderChart(data){
				
				console.log(data)
				
				Highcharts.chart('spiderChart', {
	
				    chart: {
				        polar: true,
				        backgroundColor: 'rgba(255, 255, 255, 0)',
				        type: 'area'
				    },
	
				    accessibility: {
				        description: '.'
				    },
	
				    title: {
				        text: '.',
				        x: -80
				    },
	
				    pane: {
				        size: '100%'
				    },
				    
				    credits : false,
	
				    xAxis: {
				        categories: [
				        	'<span class="spider1">온도<br>'/*+data.TEMP+*/+'</span>', 
				        	'<span class="spider1">습도<br>'/*+data.HUMI+*/+'</span>', 
				        	'<span class="spider1">PH<br>'/*+data.PH+*/+'</span>', 
				        	'<span class="spider1">토양수분<br>'/*+data.SMO+*/+'</span>',
				        	'<span class="spider1">NDVI<br>'/*+data.NDVI+*/+'</span>'],
				        tickmarkPlacement: 'on',
				        lineWidth: 0
				    },
	
				    yAxis: {
				        gridLineInterpolation: 'polygon',
				        lineWidth: 0,
				        min: 0,
				        max: 100,
				        labels: {
				          style: {
				            color: 'white'
				          }
				        }
				    },
	
				    tooltip: {
				        shared: true,
				        pointFormat: '<span style="color:{series.color};">{series.name}<b>{point.y:,.0f}</b><br/>',
				        backgroundColor:'black'
				    },
	
				    legend: {
				        align: 'right',
				        verticalAlign: 'middle',
				        layout: 'vertical'
				    },
	
				    series: [{
				    	showInLegend: false,
				        name: 'Score:',
				        data: [data.TEMP, data.HUMI, data.PH, data.SMO, data.NDVI],
				        pointPlacement: 'on',
				        fillOpacity : 0.3,
				        color: '#1c62c3',
				        lineWidth:2
				    }],
	
				    responsive: {
				        rules: [{
				            condition: {
				                maxWidth: 500
				            },
				            chartOptions: {
				                legend: {
				                    align: 'center',
				                    verticalAlign: 'bottom',
				                    layout: 'horizontal'
				                },
				                pane: {
				                    size: '85%'
				                }
				            }
				        }]
				    }
	
				});
			}
			
			function drawChartC(result){
				
				var label = [];
				var data = [];
				//var ndviImg = "";
				
				for(var i=0;i<result.length;i++){
					label.push(result[i].TM);
					data.push(result[i].NDVI);
				}
				
				var ctx = document.getElementById("chartZone").getContext('2d');
				
				myChart = new Chart(ctx, {
					type: 'line',
					data: {
						labels: label,
						datasets: [{
							label: 'NDVI',
							data: data,
							borderWidth: 2,
							backgroundColor: 'transparent',
							borderColor: '#25B372',
							borderWidth: 3,
							//pointBackgroundColor: '#ffffff',
							pointRadius: 2
						}]
					},
					options: {
						responsive: true,
						maintainAspectRatio: false,

						scales: {
							xAxes: [{
								ticks: {
									fontColor: "#77778e",
								 },
								display: true,
								gridLines: {
									color: 'rgba(119, 119, 142, 0.2)'
								}
							}],
							yAxes: [{
								ticks: {
									fontColor: "#77778e",
								 },
								display: true,
								gridLines: {
									color: 'rgba(119, 119, 142, 0.2)'
								},
								scaleLabel: {
									display: false,
									labelString: 'Thousands',
									fontColor: 'rgba(119, 119, 142, 0.2)'
								}
							}]
						},
						legend: {
							labels: {
								fontColor: "#77778e"
							},
						},
					}
				});
			}
		
		
			$(document).ready(function(){
				$("#sensorBtn-1").click(function(){
					$("#sensorDate-1").toggle();
					$("#infoBox").toggle();
				});
				
				$('#searchBtn').on('click',function(){
					var chartdata = {};
					
					chartdata.TEMP = Math.floor(Math.random() * 100);
					chartdata.HUMI = Math.floor(Math.random() * 100);
					chartdata.PH = Math.floor(Math.random() * 100);
					chartdata.SMO = Math.floor(Math.random() * 100);
					chartdata.NDVI = Math.floor(Math.random() * 100);
					
					//spiderChart(chartdata);
					
					var sensorNo = $('#sensorNo').val();
					
					$('#ndviImg1').attr('src',`https://seoul.fieldon.io/data/${sensorNo}/catalonix_show_daily_img.jpg`)
					$('#ndviImg2').attr('src',`https://seoul.fieldon.io/data/${sensorNo}/catalonix_show_ma5_img.jpg`)
					
					$.ajax({
						url : "../php/getNdviSummary.php",
						data : "sensorNo="+sensorNo,
						method : "POST",
						success : function(result){
						    console.log(result);
						    $('#ndvi1').text(result.now.NDVI_daily);
						    $('#ndvi2').text(result.now.NDVI_ma5);
						    
						    drawChartC(result.list)
						}
					})
				})
				
				$('#searchBtn').click();
			});
		</script>
	</body>
</html>
