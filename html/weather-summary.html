<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="utf-8">
		<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
		<meta name="description" content="">
		<meta name="author" content="">
		<meta name="keywords" content="">
		<!-- Favicon -->
		<link rel="icon" href="" type="image/x-icon"/>
		<!-- Title -->
		<title>상암월드컵경기장</title>
		<!-- Bootstrap css-->
		<link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
		<!-- Icons css-->
		<link href="../assets/plugins/web-fonts/icons.css" rel="stylesheet"/>
		<link href="../assets/plugins/web-fonts/font-awesome/font-awesome.min.css" rel="stylesheet">
		<link href="../assets/plugins/web-fonts/plugin.css" rel="stylesheet"/>
		<!-- Style css-->
		<link href="../assets/css/style.css" rel="stylesheet">
		<link href="../assets/css/skins.css" rel="stylesheet">
		<!-- Sidemenu css-->
		<link href="../assets/css/sidemenu/sidemenu.css" rel="stylesheet">
		<link href="../assets/css/sangam.css" rel="stylesheet">
		<link href="../assets/css/twentytwenty.css" rel="stylesheet" type="text/css">
	</head>

	<body class="main-body leftmenu">
		<!-- Loader -->
		<div id="global-loader">
			<img src="../assets/img/loader.svg" class="loader-img" alt="Loader">
		</div>
		<!-- End Loader -->
		<!-- Page -->
		<div class="page">
			<!-- Sidemenu -->
			<?include "../include/sidebar.php";?>
			<!-- End Sidemenu -->

			<!-- Main Header-->
			<?include "../include/header.php";?>
			<!-- End Main Header-->
			<!-- Main Content-->
			<div class="main-content side-content pt-0">
				<div class="container-fluid main-m-pt">
					<div class="inner-body">
						<!-- Page Header -->
						<div class="page-header">
							<div>
								<h2 class="main-content-title text-white tx-24 mg-b-5 font-weight-bold">기상센서 정보</h2>
								<ol class="breadcrumb">
									<li class="breadcrumb-item">Home</li>
									<li class="breadcrumb-item active" aria-current="page">요약분석 정보</li>
									<li class="breadcrumb-item active" aria-current="page">기상센서 정보</li>
								</ol>
							</div>
						</div>
						<!-- End Page Header -->
						<!--Row-->
						<div class="row row-sm">
							<!-- col -->
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
								<div class="card custom-card overflow-hidden">
									<div class="card-header border-bottom-0 pb-0">
										<div>
											<div class="d-flex-sb border-bottom">
												<label class="main-content-label my-auto pt-2 pb-2 tx-16">상세검색</label>
											</div>
										</div>
									</div>
									<div class="card-body">
										<div class="row row-sm">
											<div class="col-sm-12 col-lg-3 col-xl-2 margin-responsive">
												<select class="form-control" id="sensorCode">
													<option value="W004">NE기상센서</option>
													<option value="W002">NW기상센서</option>
													<option value="W001">SE기상센서</option>
													<option value="W003">SW기상센서</option>
												</select>
											</div>
											<div class="col-12 col-sm-12 col-lg-12 col-xl-6 observation-submit">
												<button class="btn ripple btn-bg pd-x-20" id="searchBtn">
													<i class="fe fe-search mr-2" style="vertical-align: inherit;"></i>조회하기
												</button>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- col end -->
							<!-- col -->
							<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12"> 
								<div class="row row-sm">
									<div class="col-xl-4 col-lg-6 col-6">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">온도</h6>
													<h4 class="card-value" id="temp">16.3 <span class="unit">ºC</span></h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="temperature-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-lg-6 col-6">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">습도</h6>
													<h4 class="card-value" id="humi">45 <span class="unit">%</span></h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="humidity-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-lg-6 col-6">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">풍향/풍속</h6>
													<h4 class="card-value" id="ws">0.2 <span class="unit">m/s</span><span class="wind-direction ml-2">북북서</span></h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="wind-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-lg-6 col-6">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">광명</h6>
													<h4 class="card-value" id="light">0</h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="light-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-lg-6 col-6">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">미세먼지</h6>
													<h4 class="card-value" id="pm10">6 <span class="unit">㎍/㎥</span><span class="pm-good pm-state ml-2">좋음</span></h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="pm10-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
									<div class="col-xl-4 col-lg-6 col-6">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">초미세먼지</h6>
													<h4 class="card-value" id="pm25">36 <span class="unit">㎍/㎥</span><span class="pm-bad pm-state ml-2">나쁨</span></h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="pm25-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="row row-sm">
									<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
										<div class="card custom-card overflow-hidden">
											<div class="card-body pt-1 pb-0">
												<div class="mb-0 value-title">
													<h6 class="card-value-title mb-0">이산화탄소</h6>
													<h4 class="card-value" id="co2">40.1 <span class="unit">ppm</span></h4>
												</div>
												<div class="chart-wrapper">
													<canvas id="carbon-chart"></canvas>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- col end -->
						</div>
						<!-- Row end -->
					</div>
				</div>
			</div>
			<!-- End Main Content-->
			<!-- Main Footer-->
			<div class="main-footer text-center">
				<div class="container">
					<div class="row row-sm">
						<div class="col-md-12">
							<span class="text-white">Copyright © 2023 <a style="color: #80b9ed;">상암월드컵경기장</a></span>
						</div>
					</div>
				</div>
			</div>
			<!--End Footer-->
		</div>
		<!-- End Page -->

		<!-- Back-to-top -->
		<a href="#top" id="back-to-top"><i class="fe fe-arrow-up"></i></a>

		<!-- Jquery js-->
		<script src="../assets/plugins/jquery/jquery.min.js"></script>

		<!-- Bootstrap js-->
		<script src="../assets/plugins/bootstrap/js/popper.min.js"></script>
		<script src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>

		<!-- Peity js-->
		<script src="../assets/plugins/peity/jquery.peity.min.js"></script>

		<!-- Select2 js-->
		<script src="../assets/plugins/select2/js/select2.min.js"></script>
		<!-- Internal Chart.Bundle js-->
		<script src="../assets/plugins/chart.js/Chart.bundle.min.js"></script>
		<!-- Internal Jquery.maskedinput js-->
		<script src="../assets/plugins/jquery.maskedinput/jquery.maskedinput.js"></script>
		<!-- Sidemenu js -->
		<script src="../assets/plugins/sidemenu/sidemenu.js"></script>
		<!-- Internal Dashboard js-->
		<!--<script src="../assets/js/crypto-exchange.js"></script>-->
		<!-- Internal Form-elements js-->
		<script src="../assets/js/form-elements.js"></script>
		<!-- Sticky js -->
		<script src="../assets/js/sticky.js"></script>
		<!-- twentytwenty -->
		<script src="../assets/js/jquery.event.move.js"></script>
		<script src="../assets/js/jquery.twentytwenty.js"></script>
		<script>
			$(function(){
				$(".twentytwenty-container[data-orientation!='vertical']").twentytwenty({default_offset_pct: 0.5});
				$(".twentytwenty-container[data-orientation='vertical']").twentytwenty({default_offset_pct: 0.5, orientation: 'vertical'});
				
				function Chg_wdirk($wdir){
					//16방
					$wdirk = "";
					
					$wdir = $wdir*1;
					
					if (0 <= $wdir && $wdir <= 11.25){
						$wdirk = "북";
					}else if (11.25 < $wdir && $wdir <= 33.75){
						$wdirk = "북북동";
					}else if (33.75 < $wdir && $wdir <= 56.25){ 
						$wdirk = "북동";
					}else if (56.25 < $wdir && $wdir <= 78.75){ 
						$wdirk = "동북동";
					}else if (78.75 < $wdir && $wdir <= 101.25){ 
						$wdirk = "동";
					}else if (101.25 < $wdir && $wdir <= 123.75){ 
						$wdirk = "동남동";
					}else if (123.75 < $wdir && $wdir <= 146.25){ 
						$wdirk = "남동";
					}else if (146.25 < $wdir && $wdir <= 168.75){ 
						$wdirk = "남남동";
					}else if (168.75 < $wdir && $wdir <= 191.25){ 
						$wdirk = "남";
					}else if (191.25 < $wdir && $wdir <= 213.75){ 
						$wdirk = "남남서";
					}else if (213.75 < $wdir && $wdir <= 236.25){ 
						$wdirk = "남서";
					}else if (236.25 < $wdir && $wdir <= 258.75){ 
						$wdirk = "서남서";
					}else if (258.75 < $wdir && $wdir <= 281.25){ 
						$wdirk = "서";
					}else if (281.25 < $wdir && $wdir <= 303.75){ 
						$wdirk = "서북서";
					}else if (303.75 < $wdir && $wdir <= 326.25){ 
						$wdirk = "북서";
					}else if (326.25 < $wdir && $wdir <= 348.75){ 
						$wdirk = "북북서";
					}else if (348.75 < $wdir){ 
						$wdirk = "북";
					}else{
						$wdirk = '-';
					}
		
					return $wdirk;
		
				}
				
				function getPm10Grade(value,id){
					
					value = value*1
					
					if(value<=30){
						$(id).text("좋음");
						$(id).attr('class','pm-good pm-state ml-1')
					}else if(value<=80){
						$(id).text("보통");
						$(id).attr('class','pm-usually pm-state ml-1')
					}else if(value<=150){
						$(id).text("나쁨");
						$(id).attr('class','pm-bad pm-state ml-1')
					}else{
						$(id).text("매우나쁨");
						$(id).attr('class','pm-very-bad pm-state ml-1')
					}
				}
		
				function getPm25Grade(value,id){
					
					value = value*1
					
					if(value<=15){
						$(id).text("좋음");
						$(id).attr('class','pm-good pm-state ml-1')
					}else if(value<=35){
						$(id).text("보통");
						$(id).attr('class','pm-usually pm-state ml-1')
					}else if(value<=75){
						$(id).text("나쁨");
						$(id).attr('class','pm-bad pm-state ml-1')
					}else{
						$(id).text("매우나쁨");
						$(id).attr('class','pm-very-bad pm-state ml-1')
					}
				}
				
				function drawChart(id,tmList,dataList,backgroundColor,borderColor){
					
				    var ctx = $(id);
					ctx.height(110);
					var myChart = new Chart(ctx, {
						type: 'line',
						data: {
							labels: tmList,
							type: 'line',
							datasets: [{
								data: dataList,
								label: '',
								backgroundColor: backgroundColor/*'rgba(249, 57, 100, 0.2)'*/,
								borderColor: borderColor/*'#f93964'*/,
								borderWidth: '2',
								pointBorderColor: 'transparent',
								pointBackgroundColor: 'transparent',
							}]
						},
						options: {
							maintainAspectRatio: false,
							legend: {
								display: false
							},
							responsive: true,
							tooltips: {
								/*mode: 'index',
								titleFontSize: 12,
								titleFontColor: '#7886a0',
								bodyFontColor: '#7886a0',
								backgroundColor: 'rgba(16, 28, 44, 0.68)',
								titleFontFamily: 'Montserrat',
								bodyFontFamily: 'Montserrat',
								cornerRadius: 3,
								intersect: false,*/
								enabled: false
							},
							scales: {
								xAxes: [{
									gridLines: {
										color: 'transparent',
										zeroLineColor: 'transparent'
									},
									ticks: {
										fontSize: 2,
										fontColor: 'transparent'
									}
								}],
								yAxes: [{
									display: false,
									ticks: {
										display: false,
									}
								}]
							},
							title: {
								display: false,
							},
							elements: {
								line: {
									borderWidth: 1
								},
								point: {
									radius: 4,
									hitRadius: 10,
									hoverRadius: 4
								}
							}
						}
					});
				}
			
				function loadData(){
					var sensorCode = $('#sensorCode').val();
					
					$.ajax({
						url : "../php/getWeatherSummary.php",
						data : "sensorCode="+sensorCode,
						method : "POST",
						success : function(result){
							var w = result.weather;
							
							var tmList = [];
							var tempList = [];
							var humiList = [];
							var wsList = [];
							var lightList = [];
							var pm10List = [];
							var pm25List = [];
							var co2List = [];
							var backgroundColor = ['rgba(98, 89, 202, 0.2)','rgba(39, 164, 251, 0.2)','rgba(2, 219, 197, 0.2)',
							    'rgba(255, 255, 0, 0.2)','rgba(247, 147, 30, 0.2)','rgba(33, 86, 206, 0.2)','rgba(249, 57, 100, 0.2)'];
							var borderColor = ['#6259ca','#27a4fb','#02dbc5','#ffff00','#f7931e','#2156ce','#f93964'];
							
							let current = "";
							$.each(w,function(index,item){
								current=item;
								tmList.push(item.TM);
								tempList.push(item.TEMP*1);
								humiList.push(item.HUMI*1);
								wsList.push(item.WS*1);
								lightList.push(item.LIGHT*1);
								pm10List.push(item.PM10*1);
								pm25List.push(item.PM25*1);
								co2List.push(item.CO2*1);
							})
							
							//console.log(current)
							$('#temp').html(current.TEMP+` <span class="unit">ºC</span>`);
							$('#humi').html(current.HUMI+` <span class="unit">%</span>`);
							$('#ws').html(current.WS+` <span class="unit">m/s</span><span class="wind-direction ml-2" id="wdText">${Chg_wdirk(current.WD)}</span>`);
							$('#light').text(current.LIGHT);
							$('#pm10').html(current.PM10+` <span class="unit">㎍/㎥</span><span class="pm-good pm-state ml-1" id="pm10Text">좋음</span>`);
							
							$('#pm25').html(current.PM25+` <span class="unit">㎍/㎥</span><span class="pm-good pm-state ml-1" id="pm25Text">좋음</span>`);
							
							getPm10Grade(current.PM10,'#pm10Text')
							getPm25Grade(current.PM10,'#pm25Text')
							
							$('#co2').html(current.CO2+` <span class="unit">ppm</span>`);

							drawChart('#temperature-chart',tmList,tempList,backgroundColor[0],borderColor[0])
							drawChart('#humidity-chart',tmList,humiList,backgroundColor[1],borderColor[1])
							drawChart('#wind-chart',tmList,wsList,backgroundColor[2],borderColor[2])
							drawChart('#light-chart',tmList,lightList,backgroundColor[3],borderColor[3])
							drawChart('#pm10-chart',tmList,pm10List,backgroundColor[4],borderColor[4])
							drawChart('#pm25-chart',tmList,pm25List,backgroundColor[5],borderColor[5])
							drawChart('#carbon-chart',tmList,co2List,backgroundColor[6],borderColor[6])
						}
					})
				}
		
				$('#searchBtn').on('click',function(){
				    loadData()
				})
				
				loadData()
			});
		</script>
		<!-- Custom js -->
		<script src="../assets/js/custom.js"></script>
	</body>
</html>
